/* Share10 App v1.0.0 09-05-2016 */
var App={};App.MainApp=function(){var a,b,c={};this.css={items:[{name:"@media (min-width: 481px)",items:[{name:".form-group",value:"margin-bottom:15px"}]},{name:"@media (max-width: 480px)",items:[{name:".form-group",value:"margin-bottom:8px"}]}]};var d={items:[{name:"loading",ac:"App.Loading"},{name:"home",ac:"App.Home"}]};SA.setAppConfig({appName:"Local5app",hostName:"https://ea1-dot-local5service.appspot.com"}),SA.res.setResPath("app/res/str/"),this.createUI=function(e){return a=this.compId,b=this,c.headerDivId=SA.getConfig(e,"headerDivId"),SA.createUI(a,d)},this.getConfig=function(){return c},this.postLoad=function(){$(document).on("click","a",function(a){a.target.target&&a.target.target.length>0&&SA.utils.isMobileDevice()&&(a.preventDefault(),window.open(a.target.href,"_blank","location=no"))})}};var app={initialize:function(){this.bindEvents()},bindEvents:function(){document.addEventListener("deviceready",this.onDeviceReady,!1)},onDeviceReady:function(){App.util.isMobileApp()&&app.receivedEvent("deviceready")},receivedEvent:function(){console.log("MainApp: deviceready: initializing APN ..");var a=PushNotification.init({android:{senderID:"1234567890"},ios:{alert:"true",badge:"true",sound:"true"},windows:{}});a.on("registration",function(a){console.log("registration event"),console.log(JSON.stringify(a)),App.myDeviceId=a.registrationId;var b=SA.lookupComponent("home");b.handleEvent({cmd:"registerDevice"})}),a.on("notification",function(b){if(console.log("notification event"),console.log(JSON.stringify(b)),b.additionalData&&b.additionalData.serviceId){var c=Number(b.additionalData.serviceId);App.util.setUserBadge(c,!0);var d=SA.lookupComponent("home");d.handleEvent({cmd:"setBadge",serviceId:c})}a.finish(function(){})}),a.on("error",function(){}),console.log("deviceready: initializing done.")}};app.initialize(),App.Banner=function(){function a(a,b,c){w=App.util.getMainComp().getConfig().headerDivId;var d=$("#"+w);d.addClass(a),1==b&&d.css("display","none"),d.html(c)}function b(a,b){if(b){var c=b.indexOf(a);if(c>=0){var d=b.indexOf(";",d+1);return d>0?b.substring(c+a.length,d):b.substring(c+a.length)}}}function c(a,b){var c='<div oid="'+k+'">'+a+"</div>",d='<div oid="'+k+'">'+b+"</div>";v.setNextPage(c),u.setNextPage(d)}function d(a){return'<div id="'+p+'">'+a+"</div>"}function e(){var a=SA.localCss(l,"ext-pan");return'<div id="'+s+'" class="'+a+'" style="display:none" >'+SA.createUI(k,B)+"</div>"}function f(){r="ban-smp-"+k;var a='<div style="display:none;position:absolute;left:0px;background-color:#000;opacity:0.5;width:100%;height:100%;z-index:100;" id="'+r+'"/>',b=SA.localCss(l,"slide-pan");q="ban-sdp-"+k;var c='<div class="'+b+'" style="display:none;" id="'+q+'">'+SA.createUI(k,A)+"</div>";return a+c}function g(a,b){var c=($(window).width(),"background-color:"+i),d="width:93%;margin-left:auto;margin-right:auto;";b&&(c=b),n="head-"+k;var e='<div oid="'+k+'" id="'+m+'" style="'+c+'"  ><div style="'+d+'">';return e+='<div id="'+n+'">'+a+"</div></div></div>"}function h(a){var b="";a&&a.length>0&&(b='<div style="text-align:center;padding-top:26px;color:white;font-size:140%;margin-top:-75px">'+a+"</div>");var c="app/res/img/backicon-wt.png",d='<img id="'+o+'" src="'+c+'" style="width:45px;margin-left:10px;padding-top:20px;padding-bottom:20px;" />';return"<div>"+d+b+"</div>"}var i,j="rgb(153, 153, 153)";this.css={items:[{name:".slide-pan",value:'position:absolute;left:0px;background-image:url("app/res/img/footer_lodyas2.png");background-repeat:repeat;width:100%;z-index:999;'},{name:".ext-pan",value:"position:absolute;top:0px;left:0px;width:100%;height:100%;z-index:999;background-color:white;"},{name:".header",value:"z-index:300;height:65px;width: 100%;background-color:"+j+"; position:fixed;top:0px;left: 0px;text-align:center;color: #f9f9f9;"},{name:".content",value:"padding-top:65px;"}]};var k,l,m,n,o,p,q,r,s,t,u,v,w,x={name:"headerFlip",lc:"App.SlickFlip",config:{}},y={name:"bodyFlip",lc:"App.SlickFlip",config:{}},z=$(window).width()/2-60,A={name:"ban-sp-form",lc:"App.FormHandler",config:{title:"",listener:this},items:[{html:"div",style:"height:40px;"},{html:"div",id:"ban-feedback",style:"margin-left:40px;font-size:130%;color:#b9b9b9;",value:"Send Feedback"},{html:"div",style:"height:20px;"},{html:"div",id:"ban-my-account",style:"margin-left:40px;font-size:130%;color:#b9b9b9;",value:"My Account"},{html:"div",style:"height:20px;"},{html:"div",id:"ban-sign-out",style:"margin-left:40px;font-size:130%;color:#b9b9b9;",value:"Sign Out"},{html:"div",style:"height:20px;"},{html:"div",id:"ban-add-svc",style:"margin-left:40px;font-size:130%;color:gray;",value:'Add a Business Icon<br><div style="font-size:80%">(For business use only)</div>'},{html:"div",style:"height:30px;"},{cmd:"cmdBSPCancel",ac:"App.Button",label:"Close",style:"margin-left:"+(z+10)+"px",config:{theme:"color"}},{html:"div",style:"height:5px;"}]},B={name:"ban-ext-form",lc:"App.FormHandler",config:{title:"",listener:this},items:[{cmd:"cmdExtPageCancel",ac:"App.Button",label:"Close",style:"position:fixed;top:0px;margin-top:20px;font-size:95%",config:{theme:"color"}},{html:"div",style:"margin-top:52px;",id:"ext-page-content"}]};this.createUI=function(b,c){k=this.compId,l=this,b.name&&(k=b.name),imageUrl=SA.getConfig(b,"imageUrl"),t=SA.getConfig(b,"listener");var d=SA.localCss(this,"header"),g=SA.localCss(this,"content");x.config={fade:!0,speed:250};var h=SA.createUI(k,x);y.config={cls:g,listener:this};var n=SA.createUI(k,y);v=SA.lookupComponent("headerFlip"),u=SA.lookupComponent("bodyFlip"),p="cont-"+k,s="ext-"+k,m="in-"+k,o="left-"+k,i=j;var q=f(),r=e();a(d,c.hidden,h);var w='<div style="display:none" id="'+k+'">'+n+"</div>"+q+r;return w},this.changeUI=function(a,c){if(c){var d=b("background-color:",c);d&&(i=d,$("#"+m).css("background-color",d))}else i=j,$("#"+m).css("background-color",i);a&&$("#"+n).html(a)},this.showFirst=function(a,b,e){v.reset(),u.reset(),0==u.curPageIdx()&&$("#"+k).show(),c(g(b),d(e))},this.showNext=function(a,b,d,e){0==u.curPageIdx()&&l.show(!0),1==e?c(g(h(b)),d):c(b,d)},this.showPrev=function(){v.showPrev(),u.showPrev()};var C=!1;this.showSPanel=function(){if(C){var a=$("#"+q);a.slideUp(100);var b=$("#"+r);b.hide(),C=!1}else{var b=$("#"+r);b.css("top","65px"),b.show();var a=$("#"+q);a.css("top","65px"),a.slideDown(200),C=!0}},this.showSinglePage=function(a,b){1==a?($("#ext-page-content").html(b),$("#"+s).fadeIn("fast")):($("#ext-page-content").html(""),$("#"+s).hide())},this.notifySubmit=function(a){"cmdBSPCancel"==a.cmd?l.showSPanel():"cmdExtPageCancel"==a.cmd&&l.showSinglePage(!1)},this.actionPerformed=function(a){if("showNext"==a.cmd){var b=a.curIdx;v.showPageIdx(b)}},this.reset=function(){v.reset(),u.reset()},this.show=function(a){1==a?($("#"+k).show(),l.showHeader(!0)):($("#"+k).hide(),l.showHeader(!1))},this.showHeader=function(a){a?$("#"+w).show():$("#"+w).hide()},this.getCustom=function(a,b){return g(a,b)};var D=0;this.postLoad=function(){function a(a){var b=a.timeStamp-D>100;return D=a.timeStamp,b}$("#"+o).hammer().bind("tap",function(b){lastDataId="",a(b)&&(0==u.curPageIdx()&&(l.show(!1),t.actionPerformed({cmd:"back"})),l.showPrev())}),$("#ban-add-svc").hammer().bind("tap",function(b){if(a(b)){l.showSPanel();var c=SA.lookupComponent("svcAdmin");c.adminService()}}),$("#ban-feedback").hammer().bind("tap",function(b){if(a(b)){l.showSPanel();var c=SA.lookupComponent("feedBack");c.showFeedbackDlg()}}),$("#ban-my-account").hammer().bind("tap",function(b){if(lastDataId="",a(b)){l.showSPanel();var c=SA.lookupComponent("userAdmin"),d=SA.lookupComponent("banner");d.showNext("adminUser","My Account",c.getAdminUI(),!0)}}),$("#ban-sign-out").hammer().bind("tap",function(b){if(lastDataId="",a(b)){SA.deleteUserAuth(),l.showSPanel();var c=SA.lookupComponent("home");c.reload()}})}},App.Feedback=function(){function a(){e()}function b(a,b,d){var e=SA.validate.evalObj(b,d);return""!=e?(c(a,"Message cannot be empty!",!1),!1):!0}function c(a,b,c){var d=SA.lookupComponent(a);d.showMessage(b,c)}function d(a,b){return i=SA.lookupComponent(a),i&&(b&&i.updateForm(b),i.showDialog(!0)),i}function e(){i.setWaiting(!1),i.showDialog(!1)}var f,g,h,i,j=$(window).width()/2-140,k={items:[{name:"feedback-dlg",lc:"App.Dialog",config:{small:!0},items:[{name:"feedback-form",lc:"App.FormHandler",config:{title:"",listener:this},items:[{html:"div",style:"height:25px;"},{html:"div",style:"font-size:115%",value:"Please send us your feedback or complaint and we will email you back. <b>We appreciate your feedback and your business!</b>"},{name:"relItemId",ac:"App.Variable"},{html:"div",style:"height:5px;"},{name:"feedMsg",ac:"App.Message"},{html:"div",style:"height:12px;"},{name:"feedText",ac:"App.TextArea",info:"Please type your message here..",required:!0,pattern:"text",config:{rows:3}},{html:"div",style:"height:10px;"},{cmd:"cmdPostFeed",ac:"App.Button",label:"Send Feedback",config:{theme:"color",defButton:!0},style:"margin-right:10px;margin-left:"+j+"px"},{cmd:"cmdCancelFeed",ac:"App.Button",label:"Cancel",config:{theme:"blank"}},{html:"div",style:"height:10px;"}]}]}]},l=!1;this.createUI=function(){f=this.compId,g=this},this.showFeedbackDlg=function(a){l||(l=!0,SA.createUI(f,k)),h=a,d("feedback-dlg",{})},this.performAction=function(a){listener&&listener.actionPerformed&&listener.actionPerformed({cmd:a})},this.notifySubmit=function(c,d,f){if("cmdPostFeed"==c.cmd){if(b("feedMsg",d,f)){var g=new FormData;g.append("msg",App.util.safeHtml(f.feedText)),g.append("relItemId",h),i.setWaiting(!0),SA.server.postForm("/rs/feedback",g,a)}}else"cmdCancelFeed"==c.cmd&&e()}},App.Heading=function(){function a(a,b){return html='<div id="'+c+'" style="margin-left:'+a+'px" >'+b+"</div>"}var b=void 0,c=void 0;this.createUI=function(d){c=this.compId,b=this;var e=SA.getConfig(d,"title","Local5"),f=SA.getConfig(d,"titleStyle",""),f="text-align:center;font-size:180%;font-weight:bold;color:#eaeaea;padding-top:22px;margin-bottom:-56px;"+f,g=($(window).width(),'<div style="'+f+'">'+e+'</div><div><div style="float:left;margin-top:28px;margin-left:0px;" id="user-menu"><img src="app/res/img/menu-lines.png" width="40"/></div><div style="float:right;margin-top:28px;margin-right:2px;" id="svc-full-reload"><img src="app/res/img/menu-reload.png" width="40"/></div></div>');return a(10,g)},this.actionPerformed=function(){},this.handleEvent=function(){};var d=0;this.postLoad=function(){function a(a){var b=a.timeStamp>d;return d=a.timeStamp,b}$("#user-menu").hammer().bind("tap",function(b){if(a(b)){var c=SA.lookupComponent("banner");c.showSPanel('<div style="height:400px">MENU PAGE</div>')}}),$("#qrcode").hammer().bind("tap",function(b){if(a(b)){var c=SA.createComponent("qrManager","App.QRManager");c.createUI(),c.showDialog()}}),$("#svc-full-reload").hammer().bind("tap",function(b){a(b)&&SA.fireEvent("home",{cmd:"postSignIn"})})}},App.Home=function(){function a(){if(SA.getUserAuth())if(d())b();else{$("#intro-pages").hide();var a=SA.lookupComponent("banner"),c={name:"heading",lc:"App.Heading"},e={name:"mappsList",lc:"App.MappList",config:{}};a.showFirst("mainPage",SA.createUI(i,c),SA.createUI(i,e))}else $("#intro-pages").fadeIn("slow")}function b(){var a=location.search.indexOf("admin/"),b="";a>0&&(b=location.search.substring(a+6)),$("#intro-pages").hide();var c=SA.lookupComponent("banner"),d={name:"heading",lc:"App.Heading",config:{}},e={name:"flexAdmin",lc:"App.FlexAdmin",config:{qstr:b}};c.showFirst("mainPage",SA.createUI(i,d),SA.createUI(i,e))}function c(){var a=location.search.indexOf("?reset"),b="";a>=0&&(b=location.search.substring(a+7)),b.length<40||(SA.deleteUserAuth(),SA.fireEvent(i,{cmd:"showResetPass",data:b}))}function d(){if(location.search){var a=location.search.indexOf("admin");return a>=0}}function e(){if(location.search){var a=location.search.indexOf("reset");return a>=0}}var f={items:[{name:"svcSearch",lc:"App.SvcSearch"},{name:"svcAdmin",lc:"App.SvcAdmin"},{name:"userAdmin",lc:"App.UserAdmin"},{name:"dlgHelper",lc:"App.DlgHelper"},{name:"feedBack",lc:"App.Feedback"},{name:"banner",lc:"App.Banner",config:{listener:this}},{name:"login",lc:"App.Login"}]},g={name:"intro",lc:"App.Intro",config:{listener:this}},h=void 0,i=void 0,j=void 0;this.createUI=function(){h=this,i=this.compId,dataManager=SA.createComponent("dataManager","App.DataManager");var a=SA.getUserAuth(),b=SA.createUI(i,f,{hidden:void 0==a});j=SA.createComponent("service","App.Service");var d=SA.createUI(i,g),k="";a&&(k="display:none",SA.fireEvent("home",{cmd:"postSignIn"})),e()&&c();var l='<div id="home-div"><div id="'+i+'">'+b+'<div id="intro-pages" style="'+k+'" >'+d+"</div></div></div>";return l},this.reload=function(){if(SA.getUserAuth())SA.fireEvent("home",{cmd:"postSignIn"});else{var a=SA.lookupComponent("banner");a.show(!1),$("#intro-pages").fadeIn("fast");var b=SA.lookupComponent("intro");b.refresh()}},this.actionPerformed=function(a){if("back"==a.cmd){var b=$("#intro-pages");b.show()}else if("showSignIn"==a.cmd){var c=SA.lookupComponent("login"),d=c.getLoginUI(),e=SA.lookupComponent("banner");e.reset(),e.show(!0),$("#intro-pages").hide(),e.showNext("login","&nbsp;&nbsp;&nbsp;",d,!0)}},this.handleEvent=function(b){function c(b){function c(a,b){"OK"==a&&SA.fireEvent(i,{cmd:"setBannerUI",data:b})}"OK"==b?(a(),e.respData.groupId&&e.respData.groupId>0?dataManager.getGroupData(e.respData.groupId,c):SA.fireEvent(i,{cmd:"setBannerUI"}),App.util.stopWorking()):(SA.deleteUserAuth(),h.reload(),App.util.stopWorking())}function d(){App.util.setUserDeviceId(App.myDeviceId)}if("postSignIn"==b.cmd){var e=SA.getUserAuth();e&&(App.util.startWorking(),App.myDeviceId&&SA.fireEvent(i,{cmd:"registerDevice"}),dataManager.clearUserServices(),dataManager.getUserServices(c))}else if("loadServices"==b.cmd)App.util.startWorking(),a(),App.util.stopWorking();else if("setBannerUI"==b.cmd){var f,g,k=b.data;k&&(f=k.dispName,g=k.dispStyle);var l={name:"heading",lc:"App.Heading",config:{title:f,titleStyle:g}},m=SA.lookupComponent("banner");m.changeUI(SA.createUI(i,l),g),App.util.stopWorking()}else if("registerDevice"==b.cmd){if(App.myDeviceId){var n=App.util.getUserData().deviceId;n&&n==App.myDeviceId||dataManager.registerDeviceId(App.myDeviceId,d)}}else if("setBadge"==b.cmd){for(var o=App.util.getUserData(),p=dataManager.getUserServices(),q=b.serviceId,r=0;r<p.length;r++)if(q==p[r].sconf.id){var s=o[q];if(s&&s>0){var t=p[r];j.setIconUI(t.divId,t.sconf,s)}else{var t=p[r];j.setIconUI(t.divId,t.sconf)}break}}else if("showResetPass"==b.cmd){var u=SA.lookupComponent("login"),v=u.getResetPassUI(b.data),w=SA.lookupComponent("banner");w.reset(),w.show(!0),$("#intro-pages").hide(),w.showFirst("reset",'<div style="color:white;font-size:170%;text-align:center;padding-top:20px">Local-5</div>',v)}}},App.Intro=function(){function a(a){for(var b='<div id="intro-imgs">',c=0;c<a.length;c++)b+='<div><img src="'+a[c]+'" width="100%" ></div>';return b+="</div>"}function b(a,b,c){var d=$(window).width(),e=($(window).height(),d-40),g=a-200,h=(d-e)/2,i="background-color:rgba(190, 190, 190, 0.5);border-radius: 10px;position:absolute;top:"+g+"px;left:"+h+"px;z-index:20;width:"+e+"px;padding:9px;",j="msg-"+f,k='<div id="'+j+'" style="'+i+'" >'+b+"</div>",l=$("#intro-text");l.css("display","none"),l.html(k),l.show();var m=SA.lookupComponent("intro-circles");return m.draw(a-15,c),g}function c(){var a=$(window).width(),b=$(window).height(),c=a-30,d=c/6.88,e=(a-c)/2,f=b-(2*d+35),g="position:absolute;top:"+f+"px;left:"+e+"px;z-index:40;";$("#intro-sign-fb").html("");var h=f+d+10;g="position:absolute;top:"+h+"px;left:"+e+"px;z-index:40;";var i='<div style="'+g+'" ><img src="app/res/img/login-email.png" width="'+c+'" /></div>';return $("#intro-sign-email").html(i),f}function d(a){var b=a.slick("slickCurrentSlide");e.actionPerformed({cmd:"showNext",curIdx:b})}this.css={items:[]};var e,f,g,h=["app/res/img/intro-pic1.jpg","app/res/img/intro-pic2.jpg","app/res/img/intro-pic3.jpg"],i={items:[{html:"div",name:"intro-text"},{name:"intro-circles",ac:"App.Circles"},{html:"div",name:"intro-sign-fb"},{html:"div",name:"intro-sign-email"}]},j=[{title:"Welcome to Local5",stitle:"Connecting businesses to the community by leveraging the Local5 App Platform."},{title:"As a User..",stitle:"You can enjoy the discounts, promotions, and features of your favorite businesses in one app."},{title:"As a Business..",stitle:"You can communicate with your users about exciting news surrounding your business and products."}],k=!1;this.createUI=function(b,c){e=this,f=this.compId,g=c.listener;var d=SA.listCreateUI(f,i,c,!0),j=a(h);return'<div id="'+f+'">'+j+d+"</div>"},this.refresh=function(){$("#"+f).resize()},this.actionPerformed=function(a){if("showNext"==a.cmd||"showPrev"==a.cmd){var d='<p style="color:white;font-size:180%;font-weight:bold;">'+j[a.curIdx].title+'</p><p style="color:black;font-size:130%">'+j[a.curIdx].stitle+"</p>",e=c();b(e,d,a.curIdx)}};var l=0;this.postLoad=function(){function a(a){var b=a.timeStamp-l>300;return l=a.timeStamp,b}var b=$("#intro-imgs");k||(k=!0,b.slick({infinite:!0,speed:300,infinite:!0,fade:!1,cssEase:"linear",arrows:!1,autoplay:!1}),b.on("afterChange",function(){d(b)}),e.actionPerformed({cmd:"showNext",curIdx:0})),$("#"+f).hammer().bind("swipeleft",function(c){a(c)&&(b.slick("slickNext"),d(b))}),$("#"+f).hammer().bind("swiperight",function(c){a(c)&&(b.slick("slickPrev"),d(b))}),$("#intro-sign-fb").hammer().bind("tap",function(b){a(b)&&console.debug("fb tap ")}),$("#intro-sign-email").hammer().bind("tap",function(b){a(b)&&g&&g.actionPerformed&&g.actionPerformed({cmd:"showSignIn"})})}},App.Login=function(){function a(a){1==a?(m=SA.lookupComponent(l),m.setWaiting(!0)):m.setWaiting(!1)}function b(a,b,d){b&&c(a,{lgEmail:b}),l=a.name;var e=SA.createUI(j,a);return 1==d?e:void $("#login-ui").html(e)}function c(a,b){App.util.mergeList(a,b)}function d(){i(n,"An email has been sent to the address below",!0),a(!1)}function e(a,b,c){var d=SA.validate.evalObj(b,c);return""!=d?(i(a,d,!1),!1):c.crPassword&&c.crPassword.length<6?(i(a,"Password too short, minimum 6 characters!",!1),!1):($("#"+a).html(""),ret=!0,!0)}function f(a,b,c){var d=SA.validate.evalObj(b,c);return""!=d?(i(a,d,!1),!1):c.lgrPassword1!=c.lgrPassword2?(i(a,"Passwords do not match!",!1),!1):c.lgrPassword1.length<6?(i(a,"Password too short, minimum 6 characters!",!1),!1):!0}function g(b){var c=jQuery.parseJSON(b);$("#login-ui").html("OK"==c.status?'<div style="font-size:115%;padding:10px;">You password has been reset successfully! <br><br>Please go to the Local5 app and Sign In with your new password.</div>':'<h2 style="font-size:115%;padding:10px;">You password reset has failed! <br><br>Please try the reset again from the Local5 app.</div>'),a(!1)}function h(b,c){if("OK"==b){i(n,"Successful",!0),a(!1);var d=SA.lookupComponent("home");d.handleEvent({cmd:"postSignIn"})}else"USERNAME_EXISTS"==c.error?i(n,"Username already exists!",!1):i(n,"Authentication failure!",!1),a(!1)}function i(a,b,c){var d=SA.comps.getCompByName(a);d.showMessage(b,c)}this.css={items:[]};var j,k,l=void 0,m=void 0,n=void 0,o={name:"login-form",lc:"App.FormHandler",config:{title:"Please Sign In",listener:this,pageStyle:!0},items:[{html:"div",value:"Please Sign In",Style:"font-size:140%"},{html:"div",style:"height:5px;"},{name:"lgMsg",ac:"App.Message"},{html:"div",style:"height:12px;"},{name:"lgEmail",ac:"App.TextField",info:"Email address",required:!0,pattern:"email",config:{type:"email"}},{name:"lgPassword",ac:"App.TextField",info:"Password",required:!0,pattern:"text",config:{type:"password"}},{html:"div",style:"height:12px;"},{cmd:"cmdLogin",ac:"App.Button",label:"Sign me in",config:{theme:"color"}},{html:"div",style:"height:25px;"},{cmd:"cmdShowCreate",ac:"App.Button",label:"Create new account",config:{type:"link"},style:"float:left;font-size:105%;margin-bottom:10px;"},{cmd:"cmdShowForgot",ac:"App.Button",label:"Forgot password?",config:{type:"link"},style:"float:right;font-size:105%;margin-bottom:10px;"}]},p={name:"forgot-pass-form",lc:"App.FormHandler",config:{title:"I Forgot my Password",listener:this,pageStyle:!0},items:[{html:"div",value:"Forgot Your Password?",Style:"font-size:140%"},{html:"div",style:"height:5px;"},{name:"fgMsg",ac:"App.Message"},{html:"div",style:"height:20px;"},{html:"p",value:"Enter your registered email address, and we will email you a reset password link:"},{name:"lgEmail",ac:"App.TextField",info:"Email address",required:!0,pattern:"email"},{html:"div",style:"height:15px;"},{cmd:"cmdEmailPass",ac:"App.Button",label:"Email me link"},{html:"div",style:"height:25px;"}]},q={name:"create-acct-form",lc:"App.FormHandler",config:{title:"Create New Account",listener:this,pageStyle:!0},items:[{html:"div",value:"Create New Account",Style:"font-size:140%"},{html:"div",style:"height:5px;"},{name:"crMsg",ac:"App.Message"},{html:"div",style:"height:12px;"},{name:"crName",ac:"App.TextField",info:"Name: First Last ",required:!0,pattern:"text"},{name:"lgEmail",ac:"App.TextField",info:"Email address",required:!0,pattern:"email",config:{type:"email"}},{name:"crPassword",ac:"App.TextField",info:"Password",config:{type:"password"},required:!0,pattern:"text"},{html:"div",style:"height:10px;"},{html:"div",style:"font-size:90%;",value:'By clicking "Create new account" below, you agree to <a style="font-size:110%" target="_blank" href="app/res/text/EULA.html" target="_blank">this End User License Agreement</a>'},{html:"div",style:"height:10px;"},{cmd:"cmdCreateAcct",ac:"App.Button",label:"Create new account"},{html:"div",style:"height:20px;"},{cmd:"cmdShowLogin",ac:"App.Button",label:"I already have an account",style:"font-size:110%",config:{type:"link"}}]},r={name:"password-reset-form",lc:"App.FormHandler",config:{title:"Reset Your Password",listener:this,pageStyle:!0},items:[{html:"div",value:"Reset Password Form",Style:"font-size:140%"},{html:"div",style:"height:5px;"},{name:"lgrMsg",ac:"App.Message"},{html:"div",style:"height:12px;"},{name:"passToken",ac:"App.Variable"},{name:"lgrPassword1",ac:"App.TextField",info:"New Password",required:!0,pattern:"text",config:{type:"password"}},{name:"lgrPassword2",ac:"App.TextField",info:"Re-type New Password",required:!0,pattern:"text",config:{type:"password"}},{html:"div",style:"height:10px;"},{cmd:"cmdResetLogin",ac:"App.Button",label:"Save Password",config:{theme:"color"}},{html:"div",style:"height:25px;"}]};this.createUI=function(){return j=this.compId,k=this,""},this.getLoginUI=function(){App.util.stopWorking();var a=SA.getAppData("userName"),c=b(o,a,!0);return'<div id="login-ui">'+c+"</div>"},this.getResetPassUI=function(a){App.util.stopWorking(),c(r,{passToken:a});var d=b(r,"",!0);return'<div id="login-ui">'+d+"</div>"},this.notifySubmit=function(c,i,j){if("cmdShowCreate"==c.cmd){var k=SA.getAppData("userName");b(q)}else if("cmdShowForgot"==c.cmd){var k=SA.getAppData("userName");b(p,k)}else if("cmdShowLogin"==c.cmd){var k=SA.getAppData("userName");b(o,k)}else if("cmdShowAgreement"==c.cmd){var l=SA.lookupComponent("banner"),m=SA.createComponent("ttf-frame","App.LinkFrame"),r=m.createUI("",{srcUrl:"app/res/text/EULA.html"});l.showSinglePage(!0,r)}else if("cmdLogin"==c.cmd){if(n="lgMsg",e("lgMsg",i,j)){var s={};s.email=j.lgEmail,s.authToken=j.lgPassword,a(!0);var t=SA.lookupComponent("dataManager");t.authLogin(s,h)}}else if("cmdCreateAcct"==c.cmd){if(n="crMsg",e("crMsg",i,j)){var s={};s.firstName=App.util.getName(j.crName,!0),s.lastName=App.util.getName(j.crName,!1),s.email=j.lgEmail,s.authToken=j.crPassword,a(!0);var t=SA.lookupComponent("dataManager");t.authCreateAcct(s,h)}}else if("cmdEmailPass"==c.cmd){if(n="fgMsg",e("fgMsg",i,j)){var s={};s.msg="EMAIL-ME-RESET-PASSWORD",s.userId=j.lgEmail,a(!0);var t=SA.lookupComponent("dataManager");t.authEmailReset(s,d)}}else if("cmdResetLogin"==c.cmd&&f("lgrMsg",i,j)){var s={};s.email=j.passToken,s.authToken=j.lgrPassword1,s.resetPassword="true",a(!0),SA.server.set("/rs/user",s,g)}},this.logoutUser=function(){SA.deleteUserAuth()}},App.util=function(){this.colorLuminance=function(a,b){a=String(a).replace(/[^0-9a-f]/gi,""),a.length<6&&(a=a[0]+a[0]+a[1]+a[1]+a[2]+a[2]),b=b||0;var c,d,e="#";for(d=0;3>d;d++)c=parseInt(a.substr(2*d,2),16),c=Math.round(Math.min(Math.max(0,c+c*b),255)).toString(16),e+=("00"+c).substr(c.length);return e},this.getListItem=function(a,b){var c=b.items;if(c&&c.length>0){var d;for(d=0;d<c.length;d++)if(a==c[d].name)return c[d]}},this.mergeList=function(a,b){var c=a.items;if(c&&c.length>0){var d=0;for(d=0;d<c.length;d++){var e=c[d];if(e.name){var f=b[e.name];e.value=f&&"~nv"!=f?f:""}}}},this.getGroupId=function(){var a=SA.getUserAuth().respData;return a.groupId},this.getUserId=function(){var a=SA.getUserAuth().respData;return a.email},this.canAdminSvc=function(a,b){var c=!1,d=SA.getUserAuth().respData;if(b&&d.groupId&&b==d.groupId)c=!0;else{var e=d.adminSvcs;c="SUPER-USER"==e?!0:e.indexOf(a)>=0}return c},this.canAdminSvcAllow=function(a){var b=SA.getUserAuth(),c=b.respData.adminSvcs;c.indexOf(a)<0&&(b.respData.adminSvcs+=","+a),SA.setUserAuth(b)},this.openUrlInWindow=function(a){window.open(a,"_system")},this.isImageUrl=function(a){return a.indexOf("/media/")>0},this.getFriendlyTime=function(a){var b=(new Date).getTime(),c=(b-a)/1e3;return 60>c?Math.round(c)+" seconds ago":3600>c?Math.round(c/60)+" minutes ago":86400>c?Math.round(c/3600)+" hours ago":604800>c?Math.round(c/86400)+" days ago":Math.round(c/604800)+" weeks ago"},this.getMyNameInfo=function(){var a=SA.getUserAuth(),b="";if(a&&(a=a.respData,a.firstName&&(b+=a.firstName,a.lastName&&(b+=" "+a.lastName)),b.length<3)){var c=a.email.indexOf("@");c>0&&(b=a.email.stubstring(0,c))}return b},this.isMobileApp=function(){var a=-1===document.URL.indexOf("http://")&&-1===document.URL.indexOf("https://");return a?!0:!1},this.getMediaUrl=function(a){return-1==a.indexOf("http")?SA.server.getMediaUrl(a):a},this.safeHtml=function(a){var b=void 0;return a&&(b=a.replace(/<\/?[^>]+(>|$)/g,"")),b},this.getName=function(a,b){var c=a.indexOf(" "),d=a;return 1==b?c>0&&(d=a.substring(0,c)):(d="",c>0&&(d=a.substring(c))),d=d.trim(),d.length>0?d[0].toUpperCase()+d.substr(1):d},this.getMainComp=function(){var a=SA.lookupComponent("_main");return a},this.startWorking=function(){var a=SA.lookupComponent("loading");a.start()},this.stopWorking=function(){var a=SA.lookupComponent("loading");a.stop()};var a=void 0;this.getUserData=function(){return a||(a=SA.getAppData("userDataObj"),a=a?jQuery.parseJSON(a):{}),a},this.setUserDeviceId=function(b){a.deviceId=b,SA.setAppData("userDataObj",JSON.stringify(a))},this.setUserBadge=function(b,c){if(App.util.getUserData(),1==c){var d=a[b];d?d++:d=1,a[b]=d}else a[b]=0;SA.setAppData("userDataObj",JSON.stringify(a))},this.delUserData=function(){SA.deleteAppData("userDataObj"),a=void 0}},App.util=new App.util,App.FlexAdmin=function(){function a(a){var b=new FormData;for(var c in a){var d=c.indexOf("flex_");if(0==d){var e=a[c];e&&b.append(c.substring(5),e)}}return b}function b(a){var b=jQuery.parseJSON(a);if("OK"==b.status){d("flex_msg","Service added successfully",!0);var c=SA.lookupComponent("banner");c.showPrev()}else d("flex_msg",b.message,!1)}function c(a,b,c){var e=SA.validate.evalObj(b,c);return""!=e?(d(a,e,!1),!1):!0}function d(a,b,c){var d=SA.comps.getCompByName(a);d.showMessage(b,c)}var e=void 0,f=void 0,g={name:"flex_add_form",lc:"App.FormHandler",config:{title:"Add new group",listener:this,pageStyle:!0},items:[{html:"div",style:"height:5px;"},{html:"div",style:"font-size:140%",value:"Group Handler"},{name:"flex_msg",ac:"App.Message"},{html:"div",style:"height:8px;"},{name:"flex_id",ac:"App.Variable"},{name:"flex_name",ac:"App.TextField",info:"Participation Group Name",required:!0,pattern:"text"},{name:"flex_dispName",ac:"App.TextField",info:"Group Label",required:!0,pattern:"text"},{name:"flex_dispStyle",ac:"App.TextField",info:"Group CSS Style",required:!1,pattern:"text"},{html:"div",style:"height:5px;"},{cmd:"flex_cmd_save",ac:"App.Button",label:"Save Changes"}]};this.createUI=function(a){f=this.compId,e=this;var b=SA.getConfig(a,"qstr");if(b&&b.length>0){var c=b.indexOf("id=");0==c&&SA.fireEvent(f,{cmd:"loadData",id:b.substring(3),kind:"group"})}return SA.createUI(f,g)},this.notifySubmit=function(d,e,f){if("flex_cmd_save"==d.cmd&&c("flex_msg",e,f)){var g=a(f);f.flex_id&&f.flex_id>0?SA.server.putForm("/rs/group",g,b):SA.server.postForm("/rs/group",g,b)}},this.handleEvent=function(a){function b(a){var b=jQuery.parseJSON(a);if("OK"==b.status){var c=b.respData,e={};for(var f in c)e["flex_"+f]=c[f];var g=SA.lookupComponent("flex_add_form");g.updateForm(e)}else d("flex_msg",b.message,!1)}if("loadData"==a.cmd){var c=a.id,e=a.kind;SA.server.get("/rs/"+e,{id:c},b)}},this.postLoad=function(){}},App.SvcAdmin=function(){function a(a){var c=jQuery.parseJSON(a);if("OK"==c.status&&c.respData){var d=c.respData,e=d.iconUrl,f=App.util.getListItem("iconUrl",i);f.config.imgUrl=e,d.iconUrl=void 0,App.util.mergeList(i,d);var h=SA.createUI(g,i);App.util.stopWorking();var j=SA.lookupComponent("banner");j.showNext("adminSvc","Modify Existing Service",h,!0)}b(!1)}function b(a){var b=SA.lookupComponent("service-add-form");b.setWaiting(1==a?!0:!1)}function c(a){var b=new FormData;return b.append("title",a.title),a.titleColor&&b.append("titleColor",a.titleColor),a.titleBG&&b.append("titleBG",a.titleBG),a.iconUrl&&b.append("iconUrl",a.iconUrl),a.iconBG&&b.append("iconBG",a.iconBG),a.info&&b.append("info",a.info),a.adUserIds&&b.append("adUserIds",a.adUserIds),b.append("address",a.address),b.append("zip",a.zip),b.append("city",a.city),a.state&&b.append("state",a.state),a.country&&b.append("country",a.country),a.id&&b.append("id",a.id),a.compName&&a.compName.length>0?b.append("compName",a.compName):b.append("compName","~nv"),a.compDef&&a.compDef.length>0?b.append("compDef",a.compDef):b.append("compDef","~nv"),a.compConfig&&a.compConfig.length>0?b.append("compConfig",a.compConfig):b.append("compConfig","~nv"),b.append("groupId",App.util.getGroupId()),b.append("showComm",a.showComm),b.append("showPoster",a.showPoster),b}function d(a){var b=jQuery.parseJSON(a);if("OK"==b.status){f("svc-add-Msg","Service added successfully",!0),App.util.canAdminSvcAllow(b.respData.id);var c=SA.lookupComponent("banner");c.showPrev()}else f("svc-add-Msg",b.message,!1)}function e(a,b,c){var d=SA.validate.evalObj(b,c);return""!=d?(f(a,d,!1),!1):!0}function f(a,b,c){var d=SA.comps.getCompByName(a);d.showMessage(b,c)}var g=void 0,h=void 0,i={name:"service-add-form",lc:"App.FormHandler",config:{title:"Add new service",listener:this,pageStyle:!0},items:[{name:"svc-add-Msg",ac:"App.Message"},{html:"div",style:"height:8px;"},{name:"id",ac:"App.Variable"},{name:"title",ac:"App.TextField",info:"Service title",required:!0,pattern:"text"},{name:"titleColor",ac:"App.TextField",info:"Title color value",required:!0,pattern:"text"},{name:"iconUrl",ac:"App.UploadSmpl",info:"Icon image",required:!1,config:{prefWidth:325,prefHeight:280}},{html:"div",style:"color:gray;margin-bottom:5px;font-size:85%",value:"Note: use fingers to move and resize photo"},{name:"iconBG",ac:"App.TextField",info:"Icon background color value",required:!0,pattern:"text"},{name:"address",ac:"App.TextField",info:"Service street address",required:!0,pattern:"text"},{name:"city",ac:"App.TextField",info:"City",required:!0,pattern:"text"},{name:"state",ac:"App.TextField",info:"State",required:!0,pattern:"text"},{name:"zip",ac:"App.TextField",info:"Zip code",required:!0,pattern:"text"},{name:"country",ac:"App.TextField",info:"Country (optional)",required:!1,pattern:"text"},{name:"adUserIds",ac:"App.TextArea",info:"Admin emails seperated by ,  (optional: you are the admin by default)",pattern:"text",config:{rows:3}},{html:"div",style:"color:gray;margin-top:15px;margin-bottom:5px;font-size:85%",value:"Tap to toggle select options below:"},{name:"showComm",ac:"App.ButtonYN",label:"Show Comments",style:"font-size:80%"},{name:"showPoster",ac:"App.ButtonYN",label:"Show Poster",style:"font-size:80%;margin-left:5px;"},{html:"div",style:"height:20px;"},{cmd:"cmdNewService",ac:"App.Button",label:"Save Changes"}]};
this.createUI=function(){h=this.compId,g=this},this.adminService=function(){var a=SA.lookupComponent("svcSearch");a.showForSignedIn("Add or Modify Service Icons",g)},this.notifySubmit=function(a,f,g){if("cmdNewService"==a.cmd)if(b(!0),e("svc-add-Msg",f,g)){var h=c(g);g.id&&g.id>0?SA.server.putForm("/rs/service",h,d):SA.server.postForm("/rs/service",h,d)}else b(!1)},this.performAction=function(b){SA.lookupComponent("svc-find-form");if("svcNew"==b.cmd){App.util.mergeList(i,{});var c=App.util.getListItem("iconUrl",i);c.config.imgUrl="";var d=SA.createUI(g,i),e=SA.lookupComponent("banner");e.showNext("adminSvc","Add Service",d,!0)}else if("svcEdit"==b.cmd){var f=b.config;App.util.startWorking(),SA.server.get("/rs/service",{id:f.id},a)}},this.handleEvent=function(a){"showLatest"==a.cmd},this.postLoad=function(){function a(a){var b=a.timeStamp>lastTime;return lastTime=a.timeStamp,b}$(".list-group-item").hammer().bind("tap",function(){}),$("#"+h).hammer().bind("swiperight",function(b){if(a(b)){var c=SA.lookupComponent("banner");c.showPrev()}})}},App.UserAdmin=function(){function a(a){var c=jQuery.parseJSON(a);if("OK"==c.status){d("changeAcctMsg","Changes Saved Successfully",!0),b(c.respData);var e=SA.lookupComponent("banner");e.showPrev()}else d("changeAcctMsg",c.message,!1)}function b(a){if(a){var b=SA.getUserAuth(),c=b.respData;a.loginToken&&a.loginToken.length>0&&(c.loginToken=a.loginToken),a.firstName&&a.firstName.length>0&&(c.firstName=a.firstName,c.lastName=a.lastName),c.groupId=a.groupId,SA.setUserAuth(b)}}function c(a,b){if(f(b.personalName))return d(a,'"Name: First Last" cannot be empty!',!1),!1;if(!f(b.oldPass)&&f(b.newPass))return d(a,"Invalid old password",!1),!1;if(f(b.newPass))$("#"+a).html(""),ret=!0;else{if(b.newPass.length<6)return d(a,"New password too short, minimum 6 characters!",!1),!1;if(f(b.oldPass)||b.oldPass.length<6)return d(a,"Invalid old password",!1),!1}return!0}function d(a,b,c){var d=SA.comps.getCompByName(a);d.showMessage(b,c)}function e(a){var b=new FormData;return f(a.personalName)||(b.append("firstName",App.util.getName(a.personalName,!0)),b.append("lastName",App.util.getName(a.personalName,!1))),f(a.groupName)?b.append("groupName",""):b.append("groupName",a.groupName),f(a.oldPass)||(b.append("oldPass",a.oldPass),b.append("newPass",a.newPass)),b}function f(a){return!a||0==a.length}var g=void 0,h=void 0,i={name:"create-acct-form",lc:"App.FormHandler",config:{title:"Create New Account",listener:this,pageStyle:!0},items:[{name:"changeAcctMsg",ac:"App.Message"},{html:"div",style:"height:5px"},{html:"div",value:"Change Name:",Style:"font-size:120%"},{html:"div",style:"height:5px;"},{name:"personalName",value:"",ac:"App.TextField",info:"Name: First Last",pattern:"text",required:!0},{html:"div",style:"height:15px;"},{html:"div",style:"width:100%;height:10px;border-top:solid silver 1px;"},{html:"div",style:"height:10px;"},{html:"div",name:"loginEmail",value:"",style:"font-size:100%"},{html:"div",style:"height:5px;"},{html:"div",value:"Change Password:",Style:"font-size:120%;margin-top:10px"},{html:"div",style:"height:5px;"},{name:"oldPass",ac:"App.TextField",info:"Old Password",config:{type:"password"},required:!1,pattern:"text"},{name:"newPass",ac:"App.TextField",info:"New Password",config:{type:"password"},required:!1,pattern:"text"},{html:"div",style:"height:5px;"},{html:"div",style:"border-top:solid silver 1px;padding-top:10px",value:'<a target="_blank" href="app/res/text/EULA.html">View End User License Agreement..</a>'},{html:"div",style:"height:10px;"},{html:"div",style:"width:100%;height:10px;border-top:solid silver 1px;"},{html:"div",value:"Participation Group:",Style:"font-size:120%;margin-top:10px"},{html:"div",style:"height:5px;"},{name:"groupName",ac:"App.TextField",info:"Enter Group Name (optional)",config:{type:"password"},required:!1,pattern:"text"},{html:"div",style:"font-size:75%",value:"Allows members to join the private group. You need to sign out and back in to be part of the group."},{html:"div",style:"height:20px;"},{cmd:"cmdSaveMyAccount",ac:"App.Button",label:"Save Changes"}]};this.createUI=function(){h=this.compId,g=this},this.getAdminUI=function(){var a={},b=SA.getUserAuth().respData;a.personalName=b.firstName+" "+b.lastName,a.loginEmail="User Id: "+b.email,a.groupName=b.groupId,App.util.mergeList(i,a);var c='<div id="'+h+'" style="background-color:white">'+SA.createUI(h,i)+"</div>";return c},this.notifySubmit=function(b,d,f){if("cmdShowAgreement"==b.cmd){var g=SA.lookupComponent("banner"),h=SA.createComponent("ttf-frame","App.LinkFrame"),i=h.createUI("",{srcUrl:"app/res/text/EULA.html"});g.showSinglePage(!0,i)}else if("cmdSaveMyAccount"==b.cmd&&1==c("changeAcctMsg",f)){var j=e(f);SA.server.postForm("/rs/admin",j,a)}},this.postLoad=function(){}},App.DataManager=function(){function a(a){j[a]=void 0}function b(){h.length=0}function c(){g[0].lastSec=0}function d(a){for(i=0;i<h.length;i++)if(a==h[i].divId)return h[i];return void 0}function e(a){for(i=0;i<h.length;i++)if(a==h[i].id)return i;return-1}function f(a){h.push(a)}var g=[{data:void 0,lastSec:0,ttlSec:60}],h=[],j={},k=60,l={};this.authLogin=function(a,d){function e(a){var e=jQuery.parseJSON(a);"OK"==e.status?(SA.setUserAuth(e),SA.setAppData("userName",e.respData.email),App.util.delUserData(),b(),c(),d("OK",e)):d(e.status,e)}SA.server.get("/rs/user",a,e)},this.authCreateAcct=function(a,d){function e(a){var e=jQuery.parseJSON(a);"OK"==e.status?(SA.setUserAuth(e),SA.setAppData("userName",e.respData.email),App.util.delUserData(),b(),c(),d("OK",e)):d(e.status,e)}SA.server.set("/rs/user",a,e)},this.authEmailReset=function(a,b){function c(a){var c=jQuery.parseJSON(a);"OK"==c.status?b("OK",c):b(c.status,c)}SA.server.set("/rs/feedback",a,c)},this.getMyServices=function(a,b){function c(a){var c=jQuery.parseJSON(a);"OK"==c.status?b("OK",c.respData):b(c.status,c.message)}a.groupId=App.util.getGroupId(),SA.server.get("/rs/service",a,c)},this.getGroupData=function(a,b){function c(a){var c=jQuery.parseJSON(a);"OK"==c.status?(l=c.respData,b("OK",c.respData)):b(c.status,c.message)}l.id&&l.id>0?b("OK",l):SA.server.get("/rs/group",{id:a},c)},this.getServices=function(a,b){function c(a){var c=jQuery.parseJSON(a);"OK"==c.status?(e.data=c.respData,b("OK",e.data)):b(c.status,c.message)}var d=(new Date).getTime()/1e3,e=g[0];d-e.lastSec>e.ttlSec?(e.lastSec=d,a.groupId=App.util.getGroupId(),SA.server.get("/rs/service",a,c)):b("OK",e.data)},this.clearFeedsCache=function(b){a(b)},this.clearUserServices=function(){b()},this.getUserServices=function(a){function b(b){var c=jQuery.parseJSON(b);if("OK"==c.status){var d=c.respData;for(i=0;i<d.length;i++){var e={id:d[i].id,sconf:d[i].service,divId:""};f(e)}a("OK",d)}else a(c.status,c.message)}return a?void(h.length>0?a("OK",h):SA.server.get("/rs/userService",{},b)):h},this.getService=function(a){for(var b=0;b<h.length;b++)if(h[b].sconf.id==a)return h[b].sconf},this.delUserService=function(a,b){function c(a){var c=jQuery.parseJSON(a);"OK"==c.status?(h.splice(d,1),b("OK",c.respData)):b(c.status,c.message)}var d=e(a);d>=0&&SA.server.del("/rs/userService",{id:a},c)},this.getUserServiceByDivId=function(a){return d(a)},this.registerDeviceId=function(a,b){function c(a){var c=jQuery.parseJSON(a);if("OK"==c.status){var d=c.respData;b("OK",d)}else b(c.status,c.message)}var d={deviceId:a,userId:App.util.getUserId()};SA.server.set("/rs/device",d,c)},this.setUserService=function(a,b,c){function e(d){var e=jQuery.parseJSON(d);if("OK"==e.status){var g=e.respData;h?h.sconf=b:(h={id:g.id,sconf:b,divId:a},f(h)),c("OK",g)}}var g={serviceId:b.id},h=d(a);h&&(g.id=h.id),SA.server.set("/rs/userService",g,e)},this.mapUserServiceToIcon=function(a,b){b.divId=a},this.savePosting=function(a,b,c){function d(a){var c=jQuery.parseJSON(a);"OK"==c.status?b("OK",c.respData):b(c.status,c.message)}1==c?SA.server.putForm("/rs/post",a,d):SA.server.postForm("/rs/post",a,d)},this.delPosting=function(b,c,d){function e(c){var e=jQuery.parseJSON(c);"OK"==e.status&&(a(b),d("OK",e.respData))}c&&SA.server.del("/rs/post",{id:c},e)},this.getPostingById=function(a,b){var c=j[a];if(c){var d,e=c.data;for(d=0;d<e.length;d++)if(e[d].id==b)return e[d]}return void 0},this.getLatestFeed=function(a,b){function c(a){var c=jQuery.parseJSON(a);if("OK"==c.status){var e=c.respData;d.data=e,d.lastSec=(new Date).getTime()/1e3,b("OK",e)}else b(c.status,c.message)}var d=j[a],e=(new Date).getTime()/1e3;!d||e-d.lastSec>k?(d||(d={},j[a]=d),SA.server.get("/rs/post",{serviceId:a},c)):b("OK",d.data)}},App.MappList=function(){function a(a,c){var d=a+c,e=$(window).width(),f=e-2*k,h=(f-l)/2,i=h+h/7,j="",m=Math.floor(d/2),n=d%2,o=a+1;for(r=0;m>r;r++)j+=b(r,2,h,i,l,o);n>0&&(j+=b(r,1,h,i,l,o));var p="margin-left:"+k+"px;margin-top:20px;",q='<div id="'+g+'" style="'+p+'" >'+j+"</div>";return q}function b(a,b,e,f,g,h){var i='<div style="float:left;height:10px;width:'+g+'px" />',j='<div style="float:left;margin-bottom:'+g+'px;">';for(c=0;b>c;c++)j+=d(a,c,e,f,h),b-1>c&&(j+=i);return j+="</div>"}function d(a,b,c,d,e){var f=c+"px",g=d+"px",h="tl"+a+"-"+b,i=2*a+b+1,j=e>=i,k=1==j?"":"display:none;",l=(c-30)/2,m=d/2-30,n=(c-90)/2,o='<img src="app/res/img/circle-pls.png" style="width:30px;margin-left:'+l+"px;margin-top:"+m+'px" /><p style="color:#b3b3b3;margin-left:'+n+'px;margin-top:10px">Add Business</p>',p='<div class="svc-tile" id="'+h+'" style="background-color:#f9f9f9;float:left;width:'+f+";height:"+g+";border-style:dashed;border-width:1px;border-radius:10px;border-color:#d0d0d0;"+k+'" >'+o+"</div>";return p}function e(a){var b=a.indexOf("-"),c=Number(a.substring(b+1)),d=Number(a.substring(2,b));c++,c>1&&(c=0,d++);var e="#tl"+d+"-"+c;$(e).fadeIn("slow")}this.css={items:[{name:"@media (min-width: 481px)",items:[{name:".mapp",value:"border-radius: 10px;"}]},{name:"@media (max-width: 480px)",items:[{name:".mapp",value:"border-radius: 10px;"}]}]};var f=void 0,g=void 0,h=void 0,i=void 0,j=void 0,k=20,l=20;this.createUI=function(){g=this.compId,f=this,h="mapp-"+g,i=SA.createComponent("service","App.Service"),j=SA.lookupComponent("dataManager");var b=a(j.getUserServices().length,10);j.getUserServices().length>0&&SA.fireEvent(g,{cmd:"mapUserSvcs"});var c='<div id="'+h+'" >'+b+"</html>";return c},this.performAction=function(a){function b(b){"OK"==b?(i.setIconUI(a.svcDivId,a.config),e(a.svcDivId)):alert("Error found")}"svcAdded"==a.cmd&&j.setUserService(a.svcDivId,a.config,b)},this.refreshView=function(){var b=a(j.getUserServices().length,10);$("#"+h).html(b),j.getUserServices().length>0&&SA.fireEvent(g,{cmd:"mapUserSvcs"})},this.handleEvent=function(a){if("mapUserSvcs"==a.cmd){var b,c,d=j.getUserServices(),e=0,f=!0;for(c=0;f;c++)for(b=0;2>b;b++){var g="tl"+c+"-"+b;if(i.setIconUI(g,d[e].sconf),d[e].divId=g,++e>=d.length){f=!1;break}}}};var m=0;this.postLoad=function(){function a(a){var b=a.timeStamp>m;return m=a.timeStamp,b}$(".svc-tile").hammer().bind("tap",function(b){if(a(b)){var c=$(this).attr("id"),d=j.getUserServiceByDivId(c);if(d){var e={ac:"App.SvcHome",config:{userService:d}},h=SA.createUI(g,e),i=SA.lookupComponent("banner"),k=App.util.safeHtml(d.sconf.title);i.showNext("nextSvc",k,h,!0)}else{var l=SA.lookupComponent("svcSearch");l.showDialog("Add Provider",c,f)}}})}},App.QRManager=function(){function a(a,b,c){currentDlgName=b,d=SA.lookupComponent(currentDlgName),d&&(c&&d.updateForm(c),d.showDialog(!0,a))}var b,c,d,e=!1,f=$(window).width()/2-65,g={items:[{name:"svc-qr-dlg",lc:"App.Dialog",config:{pageStyle:!1},items:[{name:"svc-qr-form",lc:"App.FormHandler",style:"text-align:center",config:{title:"",listener:this,fitHeight:!0},items:[{name:"qrMsg",ac:"App.Message"},{html:"div",style:"height:50px;"},{html:"div",style:"text-align:center;font-size:100%;margin-bottom:5px;color:green",value:"As a provider scan your customer code below.."},{cmd:"cmdQRScan",ac:"App.Button",label:"Scan Code",style:"margin-left:"+f+"px",config:{theme:"blank",defButton:!0}},{html:"div",style:"height:30px;"},{html:"div",style:"text-align:center;font-size:100%;margin-bottom:5px;color:green",value:"Your information and QR code are shown below.."},{html:"div",name:"qrName",style:"text-align:center;font-size:120%",value:"Your Name"},{html:"div",name:"qrEmail",style:"text-align:center;font-size:110%",value:"youremail@host.com"},{html:"div",style:"height:20px;"},{div:"html",id:"qrCode",value:'<img style="width:80%;margin-left:20px;" src="app/res/gallery/qr-sample.png"/>'},{html:"div",style:"height:20px;"},{cmd:"cmdQRCancel",ac:"App.Button",label:"Close",style:"margin-left:"+(f+10)+"px",config:{theme:"color"}},{html:"div",style:"text-align:center;font-size:100%;margin-bottom:5px;margin-top:15px;color:brown",value:"Note: in this release, this form is not functional yet!"},{html:"div",style:"height:5px;"}]}]}]};this.createUI=function(){c=this.compId,b=this,e||(SA.createUI(c,g),e=!0)},this.showDialog=function(){var b=SA.getUserAuth().respData,c={};c.qrName=b.firstName+" "+b.lastName,c.qrEmail=b.email,a("My QR Code","svc-qr-dlg",c)},this.notifySubmit=function(a){"cmdSSAdd"==a.cmd||"cmdQRCancel"==a.cmd&&d.showDialog(!1)},this.performAction=function(a,b){SA.lookupComponent("svc-qr-form");"edit"==b.cmd},this.handleEvent=function(a){"showLatest"==a.cmd},this.postLoad=function(){$(".list-group-item").hammer().bind("tap",function(){var a=$(this).attr("id"),b=a.substring(a.indexOf("-")+1),c=curSvcLatestConf[b];curMappComp.actionPerformed({cmd:"svcAdded",config:c,svcDivId:curSvcDivId}),d.showDialog(!1)}),$("#ssCancel").hammer().bind("tap",function(){console.debug("cancel")})}},App.Service=function(){function a(a,b){var d=c(a.title)?"no title":a.title,e=c(a.titleColor)?"#404040":a.titleColor,f=(c(a.address)?"no address":a.address,c(a.city)?"no city":a.city,b),g=App.util.colorLuminance(f,.1),h='<div style="font-size:85%;text-align:center;border-top:1px solid '+g+";color:"+e+";margin-bottom:2px;background-color:"+f+'"><div style="margin-top:8px">'+d+"</div></div>";return h}function b(a,b){var d=c(a.title)?"no title":App.util.safeHtml(a.title),e="brown",f=c(a.address)?"no address":a.address,g=c(a.city)?"no city":a.city;if(1==b){var h='<div style="padding:10px"><div style="color:'+e+';font-size:110%;padding-bottom:10px;"><b>'+d+'</b></div><div class="list-group-item-text">'+f+", "+g+"</div></div>";return h}var i='<div style="color:'+e+';margin-bottom:2px;"><b>'+d+'</b></div><div class="list-group-item-text">'+f+", "+g+"</div>";return i}function c(a){return a&&0!=a.length?!1:!0}var d=void 0,e=void 0,f=void 0;this.createUI=function(a){e=this.compId,d=this,f=a.config},this.titleHtml=function(a){return b(a)},this.setIconUI=function(d,e,f){var g=c(e.iconUrl)?"":e.iconUrl,h=c(e.iconBG)?"#f9f9f9":e.iconBG,i="",j=$("#"+d).width();if(c(e.iconUrl))i=b(e,!0);else{var k=a(e,h,j),l=SA.server.getMediaUrl(g),m="";f&&f>0&&(m='<div style="background-color:rgb(255,128,64);position:absolute;margin-top:-10px;font-size:90%" class="badge">'+f+"</div>"),i='<div style="margin-top:5px;margin-left:1px;">'+m+'<img style="width:99%" src="'+l+'" />'+k+"</div>"}var n=App.util.colorLuminance(h,-.08);$svcId=$("#"+d),$svcId.css("background-color",h),$svcId.css("border-style","solid"),$svcId.css("border-color",n),$svcId.html(i)},this.getConfig=function(){return f},this.postLoad=function(){}},App.SvcHome=function(){function a(){var a=SA.localCss(c,"svc"),b=f.titleHtml(e.sconf),g='<div class="'+a+'" id="'+d+'" ><div style="margin-bottom:10px;">'+b+'</div><div style="color:#B80000;margin-top:20px;" id="svc-rem" >Remove This Service<div></div>';return g}function b(a){function b(a){if("OK"==a){var b=SA.lookupComponent("banner");b.showPrev();var c=SA.lookupComponent("mappsList");c.refreshView()}}var c=SA.lookupComponent("dataManager");c.delUserService(a,b)}var c,d,e,f;this.css={items:[{name:"@media (min-width: 481px)",items:[{name:".svc",value:"width:96%;margin-top:10px;margin-left:auto;margin-right:auto;font-size:110%;"}]},{name:"@media (max-width: 480px)",items:[{name:".svc",value:"width:96%;margin-top:10px;margin-left:auto;margin-right:auto;font-size:110%;"}]}]},this.createUI=function(b){d=this.compId,c=this,f=SA.createComponent("service","App.Service"),e=b.config.userService;var g="App.Comm",h={ac:"App.SvcTabs",config:{userService:e,svcCompName:g,listener:c}},i=SA.createUI(d,h),j=a();App.util.setUserBadge(e.sconf.id,!1),SA.fireEvent("home",{cmd:"setBadge",serviceId:e.sconf.id});var k='<div style="background-color:#fbfbfb;">'+i+j+"</div>";return k},this.peformAction=function(a){if("showHtml"==a.cmd){var b='<div oid="'+d+'">'+a.data+"</div>";$("#"+d).html(b)}},this.notifySubmit=function(a,b,c){function d(a){if("OK"==a){e.showDialog(!1);var b=SA.lookupComponent("banner");b.showPrev();var c=SA.lookupComponent("mappsList");c.refreshView()}else e.setWaiting(!1)}var e=SA.lookupComponent("del-svc-dlg");if("cmdSvcRm"==a.cmd){e.setWaiting(!0);var f=SA.lookupComponent("dataManager");f.delUserService(c.id,d)}else"cmdSvcRemCancel"==a.cmd&&e.showDialog(!1)};var g=0;this.postLoad=function(){function a(a){var b=a.timeStamp>g;return g=a.timeStamp,b}$("#svc-rem").hammer().bind("tap",function(){function a(a,c){"YES"==a&&b(c)}var c=SA.lookupComponent("dlgHelper");c.showYNDialog('Remove service "'+e.sconf.title+'" ?',e.id,a)}),$("#"+d).hammer().bind("swiperight",function(b){if(a(b)){var c=SA.lookupComponent("banner");c.showPrev()}})}},App.SvcSearch=function(){function a(a,b,c){currentDlgName=b,g=SA.lookupComponent(currentDlgName),g&&(c&&g.updateForm(c),g.showDialog(!0,a))}var b,c,d,e=void 0,f=void 0,g=void 0,h=void 0,j=!1,k=!1,l=$(window).width()/2-60,m=$(window).height()-150+"px",n=$(window).height()-230+"px",o={items:[{name:"svc-find-dlg",lc:"App.Dialog",config:{pageStyle:!1},items:[{name:"svc-find-form",lc:"App.FormHandler",config:{title:"",listener:this,fitHeight:!0},items:[{name:"ssDivId",ac:"App.Variable"},{html:"div",name:"svc-find-title",style:"text-align:center;font-size:135%;margin-top:30px;margin-bottom:5px;",value:"Add a New Business"},{name:"ssMsg",ac:"App.Message"},{html:"div",style:"height:5px;"},{html:"div",id:"ssSearchBlock",items:[{id:"svc-find-desc",html:"div",style:"font-size:90%;margin-bottom:2px;color:gray",value:" Click on a business below to add:"}]},{html:"div",id:"ssCont",style:"overflow-y:scroll;-webkit-overflow-scrolling:touch;height:"+m,items:[{html:"div",id:"ssResult"}]},{html:"div",style:"height:10px;"},{name:"cmdSSCancel",cmd:"cmdSSCancel",ac:"App.Button",label:"Cancel",style:"margin-right:15px;margin-left:"+l+"px",config:{theme:"color"}},{name:"cmdSSAdd",cmd:"cmdSSAdd",ac:"App.Button",label:"Add New",style:"display:none",config:{theme:"blank"}}]}]}]};this.createUI=function(){f=this.compId,e=this,h=SA.createComponent("service","App.Service")},this.showDialog=function(c,e,g){j||(SA.createUI(f,o),j=!0),b=e,d=g,k=!1,a(c,"svc-find-dlg",{ssDivId:e,"svc-find-title":"Add a New Business"}),SA.fireEvent(f,{cmd:"showLatest"})},this.showForSignedIn=function(c,e){j||(SA.createUI(f,o),j=!0),b="",d=e,k=!0,a(c,"svc-find-dlg",{ssDivId:"","svc-find-title":c}),$("#cmdSSAdd").show(),$("#ssSearch").hide(),$("#cmdSSCancel").css("margin-left",l-50+"px"),$("#ssCont").css("height",n);var g='<p style="font-size:120%;font-weight:bold">Feel free to add a business service icon and tell your users about it. This service is currently complimentary!</p><br>Services created by me:';$("#svc-find-desc").html(g),SA.fireEvent(f,{cmd:"showLatest",userId:"signed-in"})},this.notifySubmit=function(a){"cmdSSAdd"==a.cmd?(g.showDialog(!1),d.performAction({cmd:"svcNew"})):"cmdSSCancel"==a.cmd&&g.showDialog(!1)},this.handleEvent=function(a){function b(a,b){var d="No services found";if("OK"==a&&b&&b.length>0){for(d='<div id="'+f+'" class="list-group">',i=0;i<b.length;i++){var e=h.titleHtml(b[i]);d+='<a id="svs-'+i+'" href="#" class="list-group-item"><div class="list-group-item-text">'+e+"</div></a>"}c=b,d+="</div>"}$("#ssResult").html(d)}if("showLatest"==a.cmd){$("#ssResult").html("Loading please wait..");var d,e=SA.lookupComponent("dataManager");d=a.userId?e.getMyServices({userId:a.userId},b):e.getServices({},b,!1)}},this.postLoad=function(){$(".list-group-item").hammer().bind("tap",function(){var a=$(this).attr("id"),e=a.substring(a.indexOf("-")+1),f=c[e];g.showDialog(!1),d.performAction(1==k?{cmd:"svcEdit",config:f}:{cmd:"svcAdded",config:f,svcDivId:b})}),$("#ssCancel").hammer().bind("tap",function(){console.debug("cancel")})}},App.SvcTabs=function(){function a(a){h=a;var b="<div>";for(i=0;a>i;i++){var c=m[i],d=k+i;b+='<div id="'+d+'" class="'+g+'" >'+c+"</div>"}return b+="</div>"}function b(a){var b="";if(h>0){var c=Number(a);for(i=0;h>i;i++){var d=$("#"+k+i);i==c?(d.css("background-color","white"),d.css("height","30px"),d.css("font-weight","bold")):(d.css("background-color","#f6f6f6"),d.css("height","30px"),d.css("font-weight","normal"))}b=e.getProtoTabHtml(f.sconf,c)}else b=e.getProtoTabHtml(f.sconf,0);j.peformAction({cmd:"showHtml",data:b})}var c,d,e,f,g,h,j,k="tab-",l=!0;this.css={items:[{name:"@media (min-width: 481px)",items:[{name:".cls",value:"width:100%;height:40px;background-color:#f6f6f6"},{name:".tab",value:"float:left;color:#101010;font-size:90%;margin:10px;border-right:solid white"}]},{name:"@media (max-width: 480px)",items:[{name:".cls",value:"width:100%;height:30px;background-color:#f6f6f6"},{name:".tab",value:"float:left;color:#101010;font-size:95%;padding:8px;border-right:solid white;border-width:1px;"}]},{name:"@media (max-width: 326px)",items:[{name:".cls",value:"width:100%;height:30px;background-color:#f6f6f6"},{name:".tab",value:"float:left;color:#101010;font-size:85%;padding:7px;border-right:solid white;border-width:1px;"}]}]};var m;this.createUI=function(b){c=this,d=this.compId,j=SA.getConfig(b,"listener");var i=SA.getConfig(b,"svcCompName");f=SA.getConfig(b,"userService"),k+=d+"-",e=SA.createComponent(i,i),e.createUI(),m=e.getProtoTabs(f.sconf),h=m.length,g=SA.localCss(c,"tab");var l=SA.localCss(c,"cls"),n=a(h),o="";return o=h>0?'<div class="'+l+'" id="'+d+'" >'+n+"</div>":'<div id="'+d+'" >'+n+"</div>"},this.postLoad=function(){l&&(b(0),l=!1),$("."+g).hammer().bind("tap",function(){var a=$(this).attr("id");b(a.substring(k.length))})}},App.Comm=function(){function a(a){var b={name:"postUI",ac:"App.PostUI",config:{sconf:g,pdata:a}},c=SA.createUI(k,b),d="width:100%;height:100%;",e='<div style="'+d+'" id="'+k+'">'+c+"</div>";return e}function b(a){var b=SA.lookupComponent("postUI");return b.getBanner(a)}function c(a){var b="<div>";if(App.util.canAdminSvc(a,g.groupId)){var c={name:"postBt",cmd:"cmdPostBt",ac:"App.Button",label:"New Post",style:"font-size:85%;margin-top:5px;margin-bottom:5px;border-color:#f0f0f0",config:{theme:"blank",defButton:!0,listener:j}},d=SA.createUI(k,c);b+="<div>"+d+"</div>"}return b+='<div id="'+h+'" />',b+"</div>"}function d(a){function b(a,b){if("OK"==a){var d=e(c,b,!0);$("#"+h).html(d),setTimeout(function(){App.util.stopWorking()},400)}else console.log("ERROR: "+b),App.util.stopWorking()}var c=SA.lookupComponent("dataManager");c.getLatestFeed(a,b)}function e(a,b){var c=SA.createComponent("postView","App.PostView");if(0==b.length)return'<div style="height:600px" />';var d="<div>";for(i=0;i<b.length;i++){pdata=b[i];var e=c.createUI({config:{data:pdata,showPoster:g.showPoster,showComm:g.showComm,groupId:g.groupId}});d+=e}return d+"</div>"}function f(a){var b=SA.createComponent("service","App.Service"),c="";if("CYCLE SPORTS"==a.title)c='<img style="width:100%" src="app/res/gallery/cs.jpg" />';else if("Philz Coffee"==a.title)c='<img style="width:100%" src="app/res/gallery/pc.jpg" />';else if("Encinal Hardware"==a.title)c='<img style="width:100%" src="app/res/gallery/eh.jpg" />';else if("Alameda Theatre"==a.title)c='<img style="width:100%" src="app/res/gallery/at.jpg" />';else if("OAKLAND ZOO"==a.title)c='<img style="width:100%" src="app/res/gallery/ozoo.jpg" />';else if("Cinema Grill"==a.title)c='<img style="width:100%" src="app/res/gallery/cg.jpg" />';else{var d=SA.server.getMediaUrl(a.iconUrl);c='<img class="img-responsive" src="'+d+'" />'}var e=b.titleHtml(a),f='<div><div style="margin-bottom:10px;">'+e+"</div><div>"+c+'</div><div style="color:#B80000;margin-top:20px;" id="svc-rem" >Remove This Service<div></div>';return f}var g,h,j=void 0,k=void 0;this.createUI=function(){k=this.compId,j=this,h="feed-"+k},this.getProtoTabs=function(a){return g=a,["Latest News","About Us"]},this.getProtoTabHtml=function(a,b){g=a;var d;0==b?(App.util.startWorking(),d=c(a.id,g.groupId),SA.fireEvent(k,{cmd:"loadFeeds",serviceId:a.id})):1==b&&(d=f(a));var e='<div id="'+k+'" >'+d+"</div>";return e},this.performAction=function(c,d){if("cmdPostBt"==d.cmd){var e=a(),f=b(!1),g=SA.lookupComponent("banner");g.showNext("postUI",f,e,!1)}},this.handleEvent=function(c){function e(a){"OK"==a&&SA.fireEvent(k,{cmd:"loadFeeds",serviceId:c.sid})}if("loadFeeds"==c.cmd)d(c.serviceId);else if("editPost"==c.cmd){var f=a(c.data),g=b(!0),h=SA.lookupComponent("banner");h.showNext("postUI",g,f,!1)}else if("delPost"==c.cmd){var i=SA.lookupComponent("dataManager");i.delPosting(c.sid,c.pid,e)}}},App.PostUI=function(){function a(a){j.items[1].value=a?a.msg:"";var b=SA.createUI(e,j);return b}function b(a,b,c){var d=SA.lookupComponent(a);d.showMessage(b,c)}function c(){function a(a){"OK"==a?(SA.fireEvent("App.Comm",{cmd:"loadFeeds",serviceId:f.id}),b("postErr","Post Successful",!0),App.util.stopWorking(),$("#postCan").trigger("tap")):(b("postErr","Service errors encountered! Please try again later.",!1),App.util.stopWorking())}var c=new FormData,d=SA.lookupComponent("service-post-form"),e=d.getFormComps(),h=[],j=[];for(i=0;i<e.length;i++){var k=e[i];if(k.getName&&k.getValue){var l=k.getName();if("postMsg"==l){var m=k.getValue();if(!m||0==m.trim().length)return void b("postErr","Post message cannot be blank",!1);m=App.util.safeHtml(m),c.append("msg",m)}else if(l.indexOf("postPic")>=0&&k.getValue()){h.push(k.getValue());var n="";k.getCaption()&&(n=k.getCaption(),n=App.util.safeHtml(n)),j.push(n)}}}for(c.append("serviceId",f.id),c.append("serviceTitle",f.title),i=0;i<h.length;i++)c.append("mediaId-"+i,h[i]),c.append("msg-"+i,j[i]);g&&c.append("id",g.id);var o=SA.lookupComponent("dataManager");o.savePosting(c,a,void 0!=g),o.clearFeedsCache(f.id),App.util.startWorking()}var d,e,f,g,h=0,j={name:"service-post-form",lc:"App.FormHandler",style:"margin:5px",config:{title:"",listener:this,pageStyle:!0},items:[{name:"postErr",ac:"App.Message",style:"margin:3px"},{name:"postMsg",ac:"App.TextArea",info:"Write something",config:{style:"border-color:#f5f5f5;font-size:100%;",rows:6}},{html:"div",id:"formatHelp",value:" Formatting help?",style:"font-size:80%;margin-bottom:10px;"},{name:"postPic-0",ac:"App.UploadSmpl",config:{btText:"Add photo",listener:this,addCap:!0}},{html:"div",id:"postExtra"}]};this.createUI=function(b){e=this.compId,d=this,f=b.config.sconf,g=b.config.pdata;var c=a(g),h='<div id="'+e+'">'+c+"</div>";return g&&SA.fireEvent(e,{cmd:"loadForEdit",pdata:g}),h},this.performAction=function(a,b){if("attPhoto"==b.cmd)window.imagePicker.getPictures(function(a){for(var b=0;b<a.length;b++)alert("url: "+a[b])},function(a){alert("error: "+a)},{maximumImagesCount:10,width:200});else if("imgAdded"==b.cmd){h++;var c={name:"postPic-"+h,ac:"App.UploadSmpl",style:"float:left;width:100px;font-size:90%;",config:{btText:"+ Add more",listener:this,addCap:!0,imgUrl:b.imgUrl,imgCap:b.imgCap}},d=SA.createUI(e,c);$("#postExtra").append(d);var f=SA.lookupComponent("service-post-form");f.addComponent(c.name,c.ac)}},this.getBanner=function(a){var b="background-color:#999999;margin:0px;height:65px;",c=" Post ";1==a&&(c=" Re-Post ");var d='<div style="text-align:center;padding-top:22px;font-size:120%;color:silver;margin-bottom:-15px;"><b>Post Message</b></div><div><div style="float:left;font-size:110%;color:white;padding:5px;" id="postCan"> Cancel </div><div style="float:right;font-weight:bold;font-size:115%;color:white;padding:5px;" id="postDo">'+c+"</div></div>",e=SA.lookupComponent("banner"),f=e.getCustom(d,b);return f},this.handleEvent=function(a){if("loadForEdit"==a.cmd){var b=a.pdata;if(!b.mediaIdList)return;var c;for(c=0;c<b.mediaIdList.length;c++){var f=b.mediaIdList[c],g="";b.msgList&&b.msgList[c]&&(g=b.msgList[c]),d.performAction(e,{cmd:"imgAdded",imgUrl:f,imgCap:g},d)}var h=SA.lookupComponent("service-post-form");h.removeComponent("postPic-0")}},this.postLoad=function(){$("#postCan").hammer().bind("tap",function(){var a=SA.lookupComponent("banner");a.showPrev()}),$("#postDo").hammer().bind("tap",function(){c()}),$("#formatHelp").hammer().bind("tap",function(){var a=SA.lookupComponent("dlgHelper"),b='<div style="font-size:110%"><p><b>You can use the following tags to format your message:</b></p><code>{h} Header Name {h}<br>{f} Fixed font text {f}<br>{p} Regular paragraph {p}<br>{l} Link label, http://link-url {l}<br><br>Or you can just type plain text.<br><br></code></div>';a.showOKDialog(b)})}},App.PostView=function(){function a(a){var f='<div id="'+p+'" class="'+h+'" >';return 1==l&&(f+=c(a)),f+='<div class="'+j+'">'+e(a.msg)+"</div>"+d(a),f+=b(a,m),f+"</div>"}function b(a,b){var c=0,d=0,e="ped-"+a.serviceId+"-"+a.id,f="pdl-"+a.serviceId+"-"+a.id,g='<div style="margin-top:5px;padding:5px;font-size:80%;font-weight:bold;height:30px;width:100%;color:#407fbf">';return 1==b&&(g+='<div style="float:left">'+c+" Comments&nbsp;&nbsp;&nbsp;&nbsp"+d+" Likes </div>"),App.util.canAdminSvc(a.serviceId,n)&&(g+='<div><div class="'+delCls+'" id="'+f+'">  |&nbsp; Del  )</div><div class="'+k+'" id="'+e+'">(  Edit&nbsp;&nbsp;</div></div>'),g+"</div>"}function c(a){var b='<div><img style="float:left;width:30px;margin-right:10px;" src="app/res/img/unknown.png" />';b+='<div style=""><div style="font-size:90%;font-weight:bold">'+a.userComName+"</div>";var c=App.util.getFriendlyTime(a.modifiedMs);return b+='<div style="font-size:70%;margin-bottom:10px">'+c+"</div></div>",b+"</div>"}function d(a){var b="",c=0;if(a.mediaIdList&&a.mediaIdList.length>0)for(c=0;c<a.mediaIdList.length;c++){var d=SA.server.getMediaUrl(a.mediaIdList[c]);b+='<div><img style="width:100%" src="'+d+'" /></div>',a.msgList&&c<a.msgList.length&&(b+='<div style="font-size:85%;margin:8px;">'+e(a.msgList[c])+"</div>")}return b}function e(a){for(var b={endIdx:-1},c="",d=0;b;){if(b=g(b,b.endIdx+1,a),!b){c+=a.substring(d);break}d>0&&(c+=a.substring(d,b.startIdx)),"h"==b.val?(c+="<p><b>",d=b.endIdx+1,b=g(b,d,a),b&&"h"==b.val&&(c+=a.substring(d,b.endIdx-2),c+="</b></p>",d=b.endIdx+1)):"f"==b.val?(c+="<pre>",d=b.endIdx+1,b=g(b,d,a),b&&"f"==b.val&&(c+=a.substring(d,b.endIdx-2),c+="</pre>",d=b.endIdx+1)):"l"==b.val?(c+="<a ",d=b.endIdx+1,b=g(b,d,a),b&&"l"==b.val&&(c+=f(a.substring(d,b.endIdx-2)),c+="</a><br>",d=b.endIdx+1)):"p"==b.val&&(c+="<p>",d=b.endIdx+1,b=g(b,d,a),b&&"p"==b.val&&(c+=a.substring(d,b.endIdx-2),c+="</p>",d=b.endIdx+1))}return c}function f(a){for(var b,c,d="",e=a.split(","),f=0;f<e.length;f++){var g=e[f].trim();0==g.indexOf("http")?b=g:c=g}return b?(d+='href="'+b+'" target="_blank">',d+=c?c:b):d="BAD link format! {link}label,url{link}",d}function g(a,b,c){var d=c.indexOf("{",b);if(d>=0){var e=c.indexOf("}",d+1);if(e>0)return a.val=c.substring(d+1,e).toLowerCase(),a.startIdx=d,a.endIdx=e,a}}var h,i,j,k,l,m,n,o=void 0,p=void 0;this.css={items:[{name:"@media (min-width: 481px)",items:[{name:".card",value:"margin-bottom:40px; border: 1px solid #f0f0f0;border-radius:5px;padding:10px;background-color:#fff;"},{name:".title",value:"font-size:160%;margin-top:4px;margin-bottom:4px;"},{name:".parag",value:"font-size:90%;margin-top:4px;margin-bottom:6px;"}]},{name:"@media (max-width: 480px)",items:[{name:".card",value:"margin-bottom:18px; border: 1px solid #f0f0f0;border-radius:5px;padding:5px;background-color:#fff;"},{name:".title",value:"font-size:130%;margin-bottom:2px;"},{name:".parag",value:"font-size:90%;margin-top:4px;margin-bottom:4px;"}]},{name:".editCls",value:"color:#d0d0d0;float:right"},{name:".delCls",value:"color:#d0d0d0;float:right"}]},this.createUI=function(b){p=this.compId,o=this,h=SA.localCss(this,"card"),i=SA.localCss(this,"title"),j=SA.localCss(this,"parag"),k=SA.localCss(this,"editCls"),delCls=SA.localCss(this,"delCls"),l=SA.getConfig(b,"showPoster",!0),m=SA.getConfig(b,"showComm",!0),n=SA.getConfig(b,"groupId");
var c=b.config.data;return a(c)};var q=0;this.postLoad=function(){function a(a){var b=a.indexOf("-",4),c=Number(a.substring(4,b)),d=Number(a.substring(b+1));return{sid:c,pid:d}}function b(a){var b=a.timeStamp>q;return q=a.timeStamp,b}$("."+k).hammer().bind("tap",function(c){if(b(c)){var d=$(this).attr("id"),e=a(d),f=SA.lookupComponent("dataManager"),g=f.getPostingById(e.sid,e.pid);SA.fireEvent("App.Comm",{cmd:"editPost",data:g})}}),$("."+delCls).hammer().bind("tap",function(c){function d(a){"YES"==a&&SA.fireEvent("App.Comm",{cmd:"delPost",sid:f.sid,pid:f.pid})}if(b(c)){var e=$(this).attr("id"),f=a(e),g=SA.lookupComponent("dlgHelper");g.showYNDialog("Delete this post message?",f.pid,d)}})}},App.Proto=function(){function a(a){var b=SA.createComponent("service","App.Service"),c="";if("CYCLE SPORTS"==a.title)c='<img style="width:100%" src="app/res/gallery/cs.jpg" />';else if("Philz Coffee"==a.title)c='<img style="width:100%" src="app/res/gallery/pc.jpg" />';else if("Encinal Hardware"==a.title)c='<img style="width:100%" src="app/res/gallery/eh.jpg" />';else if("Alameda Theatre"==a.title)c='<img style="width:100%" src="app/res/gallery/at.jpg" />';else if("OAKLAND ZOO"==a.title)c='<img style="width:100%" src="app/res/gallery/ozoo.jpg" />';else if("Cinema Grill"==a.title)c='<img style="width:100%" src="app/res/gallery/cg.jpg" />';else{var d=SA.server.getMediaUrl(a.iconUrl);c='<img style="width:60%" src="'+d+'" />'}var e=b.titleHtml(a),f='<div><div style="margin-bottom:10px;">'+e+"</div><div>"+c+'</div><div style="color:#B80000;margin-top:20px;" id="svc-rem" >Remove This Service<div></div>';return f}var b=void 0,c=void 0;this.createUI=function(){c=this.compId,b=this},this.getProtoTabs=function(a){var b=a.title.toLowerCase().replace(" ","-"),c=SA.res.getValue("STR:"+b+".tabs");if(c&&c.length>0){var d=c.split(",");return d}return[]},this.getProtoTabHtml=function(b,c){var d=b.title.toLowerCase().replace(" ","-"),e=SA.res.getValue("STR:"+d+".tab"+c);return e&&e.length>0?e:a(b)}},App.ButSmpl=function(){var a,b;this.css={items:[{name:".btcls",value:"border-style:solid;border-width:1px;border-radius:3px;border-color:#e3e3e3;font-size:90%;text-align:center;padding:3px;background-color:#f5f5f5"}]},this.createUI=function(c){a=this.compId,b=this,c.name&&c.name.length>0&&(a=c.name);var d="";c.style&&c.style.length>0&&(d=c.style);var e=SA.localCss(b,"btcls"),f=c.label;f||(f="Label");var g='<div id="'+a+'" style="'+d+'" class="'+e+'">'+f+"</div>";return g},this.setLabel=function(b,c){var d=$("#"+a);d.html(b),c&&d.css(c)},this.moveTo=function(b,c){var d=$("#"+a);d.css("position","absolute"),d.css("left",b),d.css("top",c)}},App.Button=function(){this.stateful=!1,this.actionListener=void 0,this.selected=!1;var a=void 0,b=void 0,c=void 0;this.css={},this.createUI=function(d){a=d;var e=SA.getConfig(d,"glyphicon"),f=SA.getConfig(d,"type","button"),g="link"==f,h=SA.getConfig(d,"theme","color"),i="blank"==h?"btn-default":"btn-warning";b||(b=SA.getConfig(d,"listener"));var j=SA.getConfig(d,"defButton",!1);j=!0;var k=d.label;k||(k="No Label");var l="";d.info&&(l='title="'+d.info+'"');var m="";d.style&&(m=d.style);var n="";e&&(n="glyphicon "+e),c=this.compId,d.name&&(c=d.name);var o="";if(g)m=""==m?"float:left;padding:8px;padding-left:0px":m,o='<div style=""'+l+'><a id="'+c+'" href="#" style="'+m+'">'+k+"</a></div>";else{m=""==m?"margin-right:8px;":m;var p=c+"-span";o=j?'<button id="'+c+'" '+l+' style="'+m+'" class="btn '+i+'"><span id="'+p+'" class="'+n+'"></span> '+k+"</button>":'<div id="'+c+'" '+l+' style="'+m+'" class="btn '+i+'"><span id="'+p+'" class="'+n+'"></span> '+k+"</div>"}return o},this.setWaiting=function(a){a?$("#"+c+"-span").addClass("glyphicon glyphicon-refresh glyphicon-refresh-animate"):$("#"+c+"-span").removeClass("glyphicon glyphicon-refresh glyphicon-refresh-animate")},this.getName=function(){return this.atomObj.name},this.setActionListener=function(a){b=a},this.showSelected=function(a){this.selected=a;var b=this.id;a?$("#"+b).addClass("active"):$("#"+b).removeClass("active")},this.triggerEvent=function(a){var b=this.id,c=$("#"+b);c&&c.trigger(a)};var d=0;this.postLoad=function(){{var c=this.id,e=(this.compId,this);$("#"+c)}$("body").on("click","#"+c,function(f){if(f.preventDefault(),!(f.timeStamp-d<4)){if(d=f.timeStamp,a.tlist&&0==a.tlist.indexOf("#compId:"))return void SA.events.fireEvent(a.tlist.substring(8),"click");var g=c;if(b&&b.performAction(g,a,e),a.tlist){var h=SA.comps.getList(a.ilist),i=SA.comps.getList(a.tlist),j="";if(i.lc){h&&(i.items||(i.items=new Array),i.items.push(h));var j=SA.listCreateUI(g,i);j&&tdiv.html(j)}else j=SA.listCreateUI(this.compId,h),j&&$("#"+i.name).html(j)}}})}},App.ButtonYN=function(){var a,b,c,d;this.createUI=function(e){a=this.compId,b=this;var f="";e.style&&(f=e.style),c=e.name,d=e.value,label=e.label;var g="";d&&1==d&&(g="active");var h='<button id="'+a+'" style="'+f+'" type="button" class="btn btn-default '+g+'" data-toggle="button" >'+label+"</button>";return h},this.getName=function(){return c},this.getValue=function(){return d=$("#"+a).hasClass("active")},this.postLoad=function(){$("#"+a).hammer().bind("tap",function(){b.getValue()&&$("#"+a).blur()})}},App.Circles=function(){function a(a){$("#"+(b+"-"+a)).addClass(f)}this.css={items:[{name:".round",value:"display:block;width:15px;height:15px;border:1px solid #e5e5e5;border-radius: 50%;box-shadow: 0 0 1px gray;float:left;margin-right:5px;"},{name:".selected",value:"background: #e0e0e0;"}]};var b,c,d,e,f;this.createUI=function(a){c=this,b=this.compId,a.name&&(b=a.name),d=SA.getConfig(a,"count",3),e=SA.localCss(this,"round"),f=SA.localCss(this,"selected");var g='<div style="display:none" id="'+b+'" />';return g},this.draw=function(c,f){for(var g="",h=0;d>h;h++)g+='<div id="'+(b+"-"+h)+'" class="'+e+'" />';var i=$(window).width(),j=20*d,k=(i-j)/2,l=$("#"+b);l.html(g),l.css("position","absolute"),l.css("top",c+"px"),l.css("left",k+"px"),l.show(),a(f)}},App.Dialog=function(){function a(){if(!f){var a=e.items[0].name;f=SA.comps.getCompByIdOrName(a)}return f}this.stateful=!0,this.htmlTempl=void 0,this.css={items:[{name:"@media (min-width: 481px)",items:[{name:".dlg",value:"width:520px;position:absolute; top:6%;left:45%;margin-top:-30px;margin-left:-200px;padding:20px;"}]},{name:"@media (max-width: 480px)",items:[{name:".dlg",value:"width:100%;position:absolute;top:0px;margin-top:0px;padding:0px;margin-left:0px"},{name:".dlg-sml",value:"width:90%;position:absolute;top:20%;margin-left:16px;padding:0px;"}]}]};var b=void 0,c=void 0,d=void 0,e=void 0,f=void 0;this.createUI=function(a){var f=SA.getConfig(a,"pageStyle",!1),g=SA.getConfig(a,"small"),h=SA.utils.isMobileDevice();if(h=!0,d=f&&h,b)return"";b=this.compId,c=b+"-page",e=a;var i=a.label;i||(i="No title provided in label field");var j="";a.style&&(j=a.style);var k="";a.items&&a.items.length>0&&(k=SA.listCreateUI(this.compId,a.items[0],{pageStyle:d}));var l=SA.localCss(this,"dlg");1==g&&(l=SA.localCss(this,"dlg-sml"));var m='<div class="modal fade" id="'+b+'" tabindex="-1" role="dialog" aria-labelledby="" aria-hidden="true"><div class="modal-dialog '+l+'" style="'+j+'" ><div id="'+c+'" class="modal-content"><div class="modal-body" style="height:100%;width:100%;" >'+k+"</div></div></div></div>";return $("#page-etc").append("<div id='"+a.name+"'></div>"),void $("#"+a.name).html(m)},this.setWaiting=function(b){var c=a();c&&c.setWaiting(b)},this.showDialog=function(a,e,f,g){if(d){var h=SA.lookupComponent(f);a?h.showNextPage(e,c,$("#"+c).html(),void 0,g):h.showPrevious()}else $("#"+b).modal(a?{show:a}:"hide")},this.updateForm=function(b){var c=a();c&&c.updateForm(b)},this.showElement=function(b,c){var d=a();d&&d.showElement(b,c)},this.postLoad=function(){}},App.DlgHelper=function(){var a,b,c,d=!1,e=!1,f=$(window).width()/2-70,g=$(window).width()/2-130,h={items:[{name:"dh-yesno",lc:"App.Dialog",config:{small:!0},items:[{name:"dh-yesno-form",lc:"App.FormHandler",config:{title:"",listener:this},items:[{html:"div",style:"height:25px;"},{name:"dh-id",ac:"App.Variable"},{name:"dh-yesNoMsg",html:"p",style:"text-align:center;font-size:110%",value:""},{html:"div",style:"height:6px;"},{cmd:"dh-cmdYes",ac:"App.Button",label:"Yes I am Sure",config:{theme:"color"},style:"margin-left:"+g+"px;margin-right:5px;"},{cmd:"dh-cmdNo",ac:"App.Button",label:"Cancel",config:{theme:"blank"}},{html:"div",style:"height:5px;"}]}]}]},i={items:[{name:"dh-ok",lc:"App.Dialog",config:{small:!0},items:[{name:"dh-ok-form",lc:"App.FormHandler",config:{title:"",listener:this},items:[{html:"div",style:"height:25px;"},{name:"dh-okMsg",html:"div",value:""},{html:"div",style:"height:6px;"},{cmd:"dh-cmdOk",ac:"App.Button",label:"Close",config:{theme:"color"},style:"margin-left:"+f+"px"},{html:"div",style:"height:5px;"}]}]}]};this.createUI=function(){b=this.compId,a=this},this.showOKDialog=function(a){0==e&&(e=!0,SA.createUI(b,i));var c=SA.lookupComponent("dh-ok");if(c){var d={"dh-okMsg":a};c.updateForm(d),c.showDialog(!0)}},this.showYNDialog=function(a,e,f){0==d&&(d=!0,SA.createUI(b,h));var g=SA.lookupComponent("dh-yesno");if(g){c=f;var i={"dh-yesNoMsg":a,"dh-id":e};g.updateForm(i),g.showDialog(!0)}},this.notifySubmit=function(a,b,d){var e;"dh-cmdYes"==a.cmd?(e=SA.lookupComponent("dh-yesno"),e.setWaiting(!0),c("YES",d["dh-id"]),e.setWaiting(!1),e.showDialog(!1)):"dh-cmdNo"==a.cmd?(e=SA.lookupComponent("dh-yesno"),e.showDialog(!1),c("NO",d["dh-id"])):"dh-cmdOk"==a.cmd&&(e=SA.lookupComponent("dh-ok"),e.showDialog(!1))}},App.EnumField=function(){function a(a){return a+"-"+d}function b(a){for(i=0;i<e.length;i++)if(e[i]!=a){var b=$("#"+e[i]);b.hasClass("active")&&b.removeClass("active")}}this.stateful=!0,this.actionListener=void 0,this.atomObj=void 0;var c="",d=void 0,e=new Array,f=void 0;this.css={items:[]},this.createUI=function(b){this.atomObj=b,d=this.compId;var g="",h=(SA.getConfigValue(b,"type","text"),"");b.info&&(g='placeholder="'+b.info+'"'),b.label&&(h='<label class="col-md-3 control-label" for="email">'+b.label+"</label>");var j=b.values;j&&0!=j.length||alert("Invalid State: expected 'values' array with name value objects"),c=b.value,c||(c=""),f=a("clkgrp");var k='<div id="'+d+'" class="form-group" ><div class="col-md-12"><div class="btn-group">';for(i=0;i<j.length;i++){var l=j[i],m=l.name==c||l.value==c?"active":"";m+=" "+f;var n=a(l.name);e.push(n),k+='<button type="button" class="btn btn-default '+m+'" id="'+n+'">'+l.value+"</button>"}return k+="</div></div></div>"},this.getValue=function(){return c},this.getName=function(){return this.atomObj.name},this.postLoad=function(){$("."+f).click(function(){c=$(this).attr("id"),$(this).addClass("active"),b(c)})}},App.FormHandler=function(){function a(a){n=new Array;{var b=a.items;this.compId}j=SA.getConfigValue(a,"title");var c="";!k&&j&&j.length>0&&(c='<div class="panel-heading" style="border-bottom:0px;">');var d="";1==l&&(d="height:"+(window.innerHeight-5)+"px");var e='<div class="panel panel-default" style="border-width:0px;background-color:transparent;box-shadow:none;-webkit-box-shadow:none;'+d+'">'+c+'<div class="row"><div class="col-md-12"><div><form class="form-horizontal" action="" method="post">',f=0;for(f=0;f<b.length;f++){var g=b[f];if(g.ac){var i=SA.getAtomComponent(g.name,g.ac);n.push(i),i.setActionListener&&i.setActionListener(h);var m=i.createUI(g,null);e+=m}else e+=SA.listCreateUI(g.compId,g,void 0,!0)}return e+="</form></div></div></div></div>"}function b(a){var b={};for(i=0;i<a.length;i++){var c=a[i];if(c.getName&&c.getValue){var d=c.getName(),e=c.getValue();void 0!=e&&(""!=e?b[d]=e:(1==e||0==e)&&(b[d]=e))}}return b}this.stateful=!0;var c,d,e,f,g,h,j,k,l,m,n=new Array;this.css={items:[{name:"@media (min-width: 481px)",items:[{name:".header",value:"padding:0px;font-size:135%;margin:0 0 0 0;"},{name:".form",value:"width:90%;padding:15px;font-size:110%;"}]},{name:"@media (max-width: 480px)",items:[{name:".header",value:"padding:0px;font-size:130%;margin:0 0 0 0;"},{name:".form",value:"width:100%;font-size:85%;"}]}]},this.createUI=function(b){if(e=b,h=this,c=SA.getConfig(b,"listener"),l=SA.getConfig(b,"fitHeight"),b.items){d=this.compId,b.name&&(d=b.name),f=SA.localCss(this,"form"),g=SA.localCss(this,"header"),k=SA.getConfig(b,"pageStyle",!1);var i="margin:20px";b.style&&b.style.length>0&&(i=b.style);var j;return j=k?'<div id="'+d+'" style="'+i+'" >'+a(b)+"</div>":'<div id="'+d+'" class="container '+f+' style="'+i+'" >'+a(b)+"</div>"}},this.updateForm=function(b){SA.utils.mergeList(e,b);var c=a(e);$("#"+d).html(c)},this.showElement=function(a,b){b?$("#"+a).show():$("#"+a).hide()},this.addFormListener=function(a){c=a},this.setWaiting=function(a){m&&m.setWaiting&&m.setWaiting(a),a?$("#"+d).find(":input").prop("disabled",!0):$("#"+d).find(":input").prop("disabled",!1)},this.performAction=function(a,d,f){if(c&&c.notifySubmit){m=f;var g=b(n);c.notifySubmit(d,e.items,g)}},this.getFormComps=function(){return n},this.getFormComponent=function(a){for(i=0;i<n.length;i++){var b=n[i];if(b.getName&&b.getName==a)return b}},this.addComponent=function(a,b){var c=SA.getAtomComponent(a,b);n.push(c)},this.removeComponent=function(a){var b;for(b=0;b<n.length;b++){var c=n[b];if(c.getName){var d=c.getName();if(d==a){n.splice(b,1),$("#"+c.compId).length>0?$("#"+c.compId).hide():$("#"+a).hide();break}}}},this.postLoad=function(){}},App.LinkFrame=function(){var a;this.createUI=function(b,c){var d="",e=c.srcUrl;e||(e=""),a=this.compId;var f=$(window).height()-50+"px";return d+='<iframe style="width:100%;height:'+f+';border:0px;" src="'+e+'" id="'+a+'"></iframe>'},this.postLoad=function(){}},App.Loading=function(){function a(){var a=$(window).width(),c=$(window).height(),d=50,e=c/2-d/2-20,f=80,g=a/2-f/2+25,h=f/3,i="display:none;border-radius:10%;position:fixed;top:"+e+"px;left:"+g+"px;z-index:1000;width:"+f+"px;height:"+d+"px",j='<div id="'+b+'" style="'+i+'" ><img src="app/res/img/350.gif" width="'+h+'" /></div>';return j}var b=void 0;this.createUI=function(){b="load-"+this.compId;var c=a(),d=$("#page-etc");return d.length||(d=$('<div id="page-etc" />').appendTo("body"),d.append(c)),""},this.start=function(){var a=$("#"+b);a.show()},this.stop=function(){var a=$("#"+b);a.hide()}},App.Message=function(){this.css={items:[{name:".errmsg",value:"padding:0px;font-weight:normal;color:#ff6600;font-size:105%;"},{name:".okmsg",value:"padding:0px;font-weight:normal;color:#00CC00;font-size:105%;"}]};var a=void 0,b=void 0,c=void 0;this.createUI=function(d){c=d.name,a=SA.localCss(this,"errmsg"),b=SA.localCss(this,"okmsg");var e=d.style;return e?'<div style="'+e+'" class="'+a+'" id="'+c+'" ></div>':'<div class="'+a+'" id="'+c+'" ></div>'},this.showMessage=function(d,e){var f=$("#"+c);f.hide(),e?(f.removeClass(a),f.addClass(b)):(f.removeClass(b),f.addClass(a)),f.html(d),f.fadeIn("slow"),setTimeout(function(){f.fadeOut("slow")},4e3)}},App.PageFlip=function(){function a(a){return a.img?'<img src="'+a.img+'" width="100%" />':a.html?a.html:""}function b(a,b,c){var d=$(window).width();if(!e(d))return c&&b.html(""),b.hide(),void a.fadeIn("slow");var f=d+"px";b.css("width",d+"px"),a.show(),b.animate({left:f},"fast",function(){c&&b.html("")})}function c(a,b){var c=a?a.width():$(window).width(),d=a?a.position().left:0;if(!e(c))return a.hide(),b.fadeIn("slow"),void(document.location.href="#top");var f=10*j;b.css({"z-index":f});var g=0;b.css("position","fixed"),b.css("overflow-y","scroll"),b.css("-webkit-overflow-scrolling","touch"),b.css("top","0px"),b.css("padding-top",g+"px"),b.css("height","100%");var h=c;b.css("left",h+"px"),b.css("width",c+"px"),b.show(),b.animate({left:d+"px"},"fast",function(){a.hide()})}function d(){for(i=0;i<m.length;i++)$("#"+m[i].name).hide()}function e(){return!0}this.css={items:[{name:"@media (min-width: 481px)",items:[{name:"fcls",value:"width:500px;height:400px;background-color:#f9f9f9;"}]},{name:"@media (max-width: 480px)",items:[{name:"fcls",value:"width:100%;height:400px;background-color:#f9f9f9;"}]}]};var f,g,h,j=0,k=0,l=!1,m=new Array;this.createUI=function(b){if(f=this.compId,g=this,l=SA.getConfig(b,"selfHandle"),b.config&&b.config.pages){var c=b.config.pages;for(i=0;i<c.length;i++){var d="pf-"+i+"-",e={name:d+f,id:i,title:c[i].title,html:a(c[i])};m.push(e)}k=c.length}else{for(i=0;3>i;i++){var d="pf-"+i+"-",e={name:d+f,id:i,title:"t"+i,html:""};m.push(e)}k=0}var j=SA.localCss(this,"fcls"),n='<div id="'+f+'" class="'+j+'" >';for(i=0;i<m.length;i++)n+='<div id="'+m[i].name+'" style="display:none" ></div>';return n+="</div>",b.config.listener&&(h=b.config.listener),k>0&&SA.fireEvent(f,{cmd:"refresh"}),n},this.reset=function(){j=0},this.curPageIdx=function(){return j},this.handleEvent=function(a){"refresh"==a.cmd&&g.showNext()},this.showNext=function(){j>=m.length&&(j=0),g.showNextPage(m[j].id,m[j].title,m[j].html),h&&h.actionPerformed({cmd:"showNext",curIdx:j-1})},this.showPrev=function(){if(1==j)return void(j=k);lastDataId=0,j--;var a=$("#"+m[j-1].name),c=$("#"+m[j].name),d=!0;b(a,c,d),h&&h.actionPerformed({cmd:"showPrev",curIdx:j-1})},this.showNextPage=function(a,b,e){if(0==j){d();var f=$("#"+m[0].name);return f.html(e),f.css("position","fixed"),f.css("overflow-y","scroll"),f.css("-webkit-overflow-scrolling","touch"),f.css("height","100%"),f.css("width","100%"),f.fadeIn("fast"),void j++}lastDataId=a,m[j].title=b,m[j].dataId=a;var g=$("#"+m[j-1].name),h=$("#"+m[j].name);h.hide(),h.html(e),c(g,h),j++},this.postLoad=function(){function a(a){var c=a.timeStamp>b;return b=a.timeStamp,c}1==l&&($("#"+f).hammer().bind("swipeleft",function(b){a(b)&&g.showNext()}),$("#"+f).hammer().bind("swiperight",function(b){a(b)&&g.showPrev()}),$("#"+f).hammer().bind("tap",function(b){!a(b)}));var b=0}},App.SlickFlip=function(){var a,b,c,d,e=!1,f=void 0;this.createUI=function(e){a=this.compId,b=this,e.name&&(a=e.name),e.config.listener&&(f=e.config.listener);var g=SA.getConfig(e,"cls","");c=SA.getConfig(e,"fade",!1),d=SA.getConfig(e,"speed",200);var h='<div id="'+a+'" class="'+g+'" />';return h},this.reset=function(){var b=$("#"+a);b.slick("slickRemove",0)},this.curPageIdx=function(){var b=$("#"+a).slick("slickCurrentSlide");return b},this.showPageIdx=function(b){$("#"+a).slick("slickGoTo",b)},this.showNext=function(){$("#"+a).slick("slickNext")},this.showPrev=function(){var b=$("#"+a),c=b.slick("slickCurrentSlide");c>0&&b.slick("slickPrev"),f&&f.actionPerformed({cmd:"showPrev",curIdx:c-1})},this.setNextPage=function(b){var c=$("#"+a);c.slick("slickAdd",b),$("#page").animate({scrollTop:0},0),c.slick("slickNext")},this.postLoad=function(){var b=$("#"+a);e||(e=!0,b.slick({infinite:!0,speed:d,infinite:!1,fade:c,cssEase:"linear",arrows:!1,autoplay:!1}),b.on("afterChange",function(){var a=b.slick("slickCurrentSlide");a>=0&&b.slick("slickRemove",a+1)}),b.on("swipe",function(){if(f){var b=$("#"+a).slick("slickCurrentSlide");f.actionPerformed({cmd:"showNext",curIdx:b})}}))}},App.TextArea=function(){this.stateful=!0,this.actionListener=void 0,this.atomObj=void 0;var a,b,c="";this.css={},this.createUI=function(d){b=d,a=this.compId,b.name&&(a=b.name);var e=(SA.getConfig(b,"cols",-1),SA.getConfig(b,"style","")),f="";if(b.info){var g="";f=' placeholder="'+b.info+g+'"'}var h="";b.label&&(h='<label class="col-md-3 control-label" for="email">'+b.label+"</label>"),c=b.value;var i="";c&&""!=c?i=c:c="";var j='<div class="form-group" >'+h+'<div class="col-md-12"><textarea style="font-size:110%;overflow:hidden;'+e+'" class="form-control" id="'+a+'" '+f+" >"+c+"</textarea></div></div>";return SA.fireEvent(a),j},this.getValue=function(){return c=$("#"+a).val()},this.getName=function(){return b.name},this.refresh=function(){SA.fireEvent(a)},this.handleEvent=function(){$ta=$("#"+a),$ta.textareaAutoSize()}},App.TextField=function(){this.stateful=!0,this.actionListener=void 0,this.atomObj=void 0;var a="";this.css={},this.createUI=function(b){this.atomObj=b;var c=this.compId,d="",e=SA.getConfigValue(b,"type","text"),f='type="'+e+'"',g="";if(b.info){var h="";d='placeholder="'+b.info+h+'"'}b.label&&(g='<label class="col-md-3 control-label" for="email">'+b.label+"</label>"),a=b.value;var i="";a&&""!=a&&(i='value="'+a+'" ');var j='<div class="form-group">'+g+'<div class="col-md-12"><input '+f+' style="font-size:110%;" class="form-control" id="'+c+'" '+i+d+" /></div></div>";return j},this.getValue=function(){return a=$("#"+this.compId).val()},this.getName=function(){return this.atomObj.name}},App.UploadSmpl=function(){function a(a,b){var c=b;c||(c="");var d={name:"cap-"+j,ac:"App.TextArea",info:"Set caption..",value:c,config:{style:"border-color:#f5f5f5;font-size:90%;",rows:1}};return SA.createUI(j,d)}function b(a){return a.indexOf("youtu")>0}function c(a){var b=SA.lookupComponent(a);return b&&b.showDialog(!0,"","appBanner"),b}function d(){var a=SA.lookupComponent("youtube-dlg");a.showDialog(!1,"","appBanner")}function e(a,b,c){var d=SA.validate.evalObj(b,c);return""!=d?!1:!0}function f(a){var b,c='class="img-responsive"';b=a?"<img "+c+' id="'+m+'" src="'+a+'">':"<img "+c+' id="'+m+'" src="'+s+'">',g(b),t&&t.performAction&&(1==u?(t.performAction(j,{cmd:"imgAdded"},this),u=!1):0==u&&t.performAction(j,{cmd:"imgUpdated"},this))}function g(a){var b=$("#"+l);b.html(a),b.fadeIn("slow");var c=$("#captf-"+j),d=5,e=SA.lookupComponent("set-photo-"+j);if(e.setLabel("Change",{background:"rgba(200,200,200,0.4)",color:"black","border-color":"silver",width:"70px"}),e.moveTo(b.position().left+5,d),n){c.html(n);var f=SA.lookupComponent("cap-"+j);f&&f.refresh()}o&&o>0&&SA.fireEvent(j,{cmd:"refresh"})}var h,i,j,k,l,m,n,o,p,q,r,s="app/res/icon/icon-preview.jpg",t=void 0,u=!0;this.css={items:[{name:".card",value:"margin-bottom:0px; border: 1px solid #dddddd;padding:0px;background-color:#f9f8f7"}]},this.flow={items:[{name:"youtube-dlg",lc:"App.Dialog",items:[{name:"youtube-form",lc:"App.FormHandler",config:{title:"Embed YouTube Video",listener:this},items:[{html:"p",style:"font-size:100%",value:"YouTube video URL (copy and paste video link here)"},{name:"youtubeUrl",ac:"App.TextField",info:"YouTue video URL",required:!0,pattern:"text"},{html:"div",style:"height:6px;"},{cmd:"cmdUTubeUrl",ac:"App.Button",label:"OK",config:{theme:"color"}},{cmd:"cmdUTubeCancel",ac:"App.Button",label:"Cancel",config:{theme:"blank"}},{html:"div",style:"height:6px;"}]}]}]},this.createUI=function(c){j=this.compId,k=c,l="preview-"+j,m="image-"+j,SA.listCreateUI(j,this.flow);var d=SA.getConfig(c,"prefWidth"),e=SA.getConfig(c,"prefHeight");o=e/d,t=SA.getConfig(c,"listener");var f=SA.getConfig(c,"addCap"),g=SA.getConfig(c,"imgUrl"),h=SA.getConfig(c,"imgCap");h&&(f=!0),1==f&&(n=a(c,h));var i="float:left;width:90px;font-size:90%;margin-right:5px;";c.style&&c.style.length>0&&(i=c.style);var p="";k.info&&(p='placeholder="'+k.info+'"');var q=SA.getConfig(c,"btText");q||(q="Set Photo"),u=!0,g&&g.length>0?(s=App.util.getMediaUrl(g),k.value=g,imgFle=void 0,u=!1,SA.fireEvent(j,{cmd:"loadExisting"})):s="app/res/icon/icon-preview.jpg";var r={name:"set-photo-"+j,ac:"App.ButSmpl",style:i,label:q,config:{theme:"blank"}},v={name:"set-utube-"+j,ac:"App.ButSmpl",style:"font-size:90%;margin-right:5px;",label:"YouTube",config:{theme:"blank"}},w=SA.listCreateUI(j,r,null,!0);w=SA.injectClass(w,"needsclick");var x="";if(1==SA.getConfig(c,"youTube")){var x=SA.listCreateUI(j,v,null,!0);x=SA.injectClass(x,"needsclick")}var y=SA.localCss(this,"card"),z="";z=b(s)?App.util.getYouTubeHtml(s):'<img  class="img-responsive" src="'+s+'">';var A='<div id="'+j+'" class="form-group"><div class="col-md-12"><div id="'+l+'" style="display:none" class="'+y+'">'+z+"</div><div>"+w+'<div id="captf-'+j+'" /><input type="file" id="file-'+j+'" style="display:none" />'+x+"</div></div></div>";return A},this.getValue=function(){if(i)return i;if(o&&o>0){var a=$("#"+m).cropper("getCroppedCanvas");if(a.toDataURL){for(var b=a.toDataURL("image/png"),c=atob(b.split(",")[1]),d=[],e=0;e<c.length;e++)d.push(c.charCodeAt(e));var f=new Blob([new Uint8Array(d)],{type:"image/png"});return f}}else{if(h)return h;if(k.value)return k.value}},this.getName=function(){return k.name},this.getCaption=function(){var a=SA.lookupComponent("cap-"+j);return a.getValue()},this.notifySubmit=function(a,b,c){if("cmdUTubeUrl"==a.cmd&&e("commMsg",b,c)){i=c.youtubeUrl;var f=App.util.getYouTubeHtml(i);g(f)}d()},this.handleEvent=function(a){if("loadExisting"==a.cmd)f();else if("refresh"==a.cmd){{var b=$("#"+l);b.offset().left,b.position().top}p=b.width()+2,q=Math.round(p*o);var c=$("#"+m);r=p,b.css("height",q+"px"),c.cropper({viewMode:3,dragMode:"move",autoCropArea:1,restore:!1,modal:!1,guides:!1,highlight:!1,cropBoxMovable:!1,cropBoxResizable:!1,built:function(){c.cropper("setCropBoxData",{width:p,height:q})}})}},this.postLoad=function(){var a=$("#set-photo-"+j),b=$("#del-photo-"+j),d=$("#file-"+j),e=$("#set-utube-"+j);a.hammer().bind("tap",function(){i=void 0,d.trigger("click")}),e.click(function(){c("youtube-dlg")}),b.click(function(){t.performAction(j,{cmd:"imgRemoved"},this)}),d.change(function(a){return a.preventDefault(),h=this.files[0],reader=new FileReader,reader.onload=function(a){f(a.target.result)},h&&reader.readAsDataURL(h),!1})}},App.Variable=function(){var a=void 0;this.createUI=function(b){return a=b,""},this.getName=function(){return a.name},this.getValue=function(){return a.value},this.setValue=function(b){a.value=b}};